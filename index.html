<!doctype html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Mu Online 99B Marketplace</title>
  
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&amp;display=swap" rel="stylesheet">
  
  <style>
    body { box-sizing: border-box; margin: 0; padding: 0; height: 100%; font-family: 'Inter', sans-serif; }
    html { height: 100%; }
    
    /* Animaciones y Efectos */
    .category-btn { transition: all 0.3s ease; }
    .category-btn:hover { transform: translateY(-2px); }
    
    .product-card { transition: all 0.3s ease; }
    .product-card:hover { transform: translateY(-5px); box-shadow: 0 10px 25px rgba(0,0,0,0.3); }
    
    .loading-spinner {
      border: 3px solid rgba(255,255,255,0.3);
      border-top: 3px solid white;
      border-radius: 50%;
      width: 20px; height: 20px;
      animation: spin 1s linear infinite;
    }
    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    
    .cart-badge {
      position: absolute; top: -8px; right: -8px;
      background-color: #ef4444; color: white;
      border-radius: 50%; width: 24px; height: 24px;
      display: flex; align-items: center; justify-content: center;
      font-size: 12px; font-weight: bold;
    }
    
    .modal-backdrop { background-color: rgba(0, 0, 0, 0.7); }
    
    .star { cursor: pointer; transition: all 0.2s ease; }
    .star:hover { transform: scale(1.2); }
    
    .top-shop-card { transition: all 0.3s ease; }
    .top-shop-card:hover { transform: translateX(5px); }

    /* Scrollbar personalizada */
    ::-webkit-scrollbar { width: 8px; }
    ::-webkit-scrollbar-track { background: rgba(0,0,0,0.1); }
    ::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.2); border-radius: 4px; }
    ::-webkit-scrollbar-thumb:hover { background: rgba(255,255,255,0.3); }
    
    @view-transition { navigation: auto; }
  </style>
</head>
<body>

  <div id="app" class="min-h-full"></div>
  <div id="modalContainer"></div>

  <script>
    // ==========================================
    // 1. CONFIGURACIÃ“N Y SDKS INTEGRADOS (Sin archivos externos)
    // ==========================================
    const BIN_ID = "691ddaa6ae596e708f6321c9"; 
    const API_KEY = "$2a$10$6.Y19X/sB3np.3CIJmbJZesuwRVxU77ns.FyAdL2dUc46k1vWFG9S"; 

    // DATA SDK (Base de Datos)
    window.dataSdk = {
      init: async (handler) => {
        window.dataHandler = handler;
        await window.dataSdk.refresh();
        return { isOk: true };
      },
      refresh: async () => {
        try {
          const res = await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}/latest`, {
            headers: { 'X-Master-Key': API_KEY }
          });
          if (!res.ok) throw new Error("Error API");
          const json = await res.json();
          window.currentData = Array.isArray(json.record) ? json.record : [];
          window.dataHandler.onDataChanged(window.currentData);
        } catch (e) {
          console.error("Error conectando BD:", e);
          window.currentData = []; 
          window.dataHandler.onDataChanged(window.currentData);
        }
      },
      create: async (item) => {
        item.__backendId = Date.now().toString() + Math.random().toString(36).substr(2, 9);
        window.currentData.push(item);
        return await window.dataSdk.save();
      },
      update: async (item) => {
        const idx = window.currentData.findIndex(i => i.__backendId === item.__backendId);
        if (idx !== -1) { window.currentData[idx] = item; return await window.dataSdk.save(); }
        return { isOk: false };
      },
      delete: async (item) => {
        window.currentData = window.currentData.filter(i => i.__backendId !== item.__backendId);
        return await window.dataSdk.save();
      },
      save: async () => {
        try {
          await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}`, {
            method: 'PUT',
            headers: { 'Content-Type': 'application/json', 'X-Master-Key': API_KEY },
            body: JSON.stringify(window.currentData)
          });
          window.dataHandler.onDataChanged(window.currentData);
          return { isOk: true };
        } catch (e) { return { isOk: false }; }
      }
    };

    // ELEMENT SDK (ConfiguraciÃ³n Visual)
    window.elementSdk = {
      config: null,
      init: (opts) => { 
        window.elementSdk.config = opts.defaultConfig;
        if(opts.onConfigChange) opts.onConfigChange(opts.defaultConfig); 
      },
      setConfig: (newConfig) => { window.elementSdk.config = { ...window.elementSdk.config, ...newConfig }; },
      getConfig: () => window.elementSdk.config
    };

    // ==========================================
    // 2. LÃ“GICA DE LA APLICACIÃ“N
    // ==========================================
    
    const defaultConfig = {
      site_title: "Mu Online 99B Marketplace",
      welcome_message: "Bienvenido a nuestra tienda de items premium",
      contact_info: "Contacto: Discord/WhatsApp",
      background_color: "#0f172a",
      card_background: "#1e293b",
      text_color: "#f1f5f9",
      primary_button: "#3b82f6",
      secondary_button: "#10b981",
      font_family: "Inter",
      font_size: 16
    };

    // Estado Global
    let currentUser = null;
    let currentView = 'catalog';
    let selectedCategory = 'all';
    let allProducts = [], allUsers = [], allOrders = [], allReviews = [];
    let cart = [];
    let showModal = null;
    let selectedOrder = null;
    let onlineUsers = new Set();
    let userActivityTimeout = null;

    const CATEGORIES = [
      { id: 'all', name: 'Todos', icon: 'ğŸ®' },
      { id: 'promotions', name: 'Promociones', icon: 'ğŸ”¥' },
      { id: 'items', name: 'Items', icon: 'âš”ï¸' },
      { id: 'jewels', name: 'Joyas', icon: 'ğŸ’' },
      { id: 'wings', name: 'Alas', icon: 'ğŸ¦…' },
      { id: 'sets', name: 'Sets', icon: 'ğŸ›¡ï¸' } 
    ];

    const ADMIN_CREDENTIALS = { username: 'Kaleb', password: 'Kaleb.2021' };

    // Manejador de Datos
    const dataHandler = {
      onDataChanged(data) {
        if(!Array.isArray(data)) data = [];
        allProducts = data.filter(i => i.type === 'product');
        allUsers = data.filter(i => i.type === 'user');
        allOrders = data.filter(i => i.type === 'order');
        allReviews = data.filter(i => i.type === 'review');
        
        // Actividad de usuarios (Online/Offline)
        const activity = data.filter(i => i.type === 'activity');
        const fiveMinAgo = Date.now() - (5*60*1000);
        onlineUsers = new Set(activity.filter(a => new Date(a.last_activity).getTime() > fiveMinAgo).map(a => a.username));
        
        checkPendingReviews();
        render();
      }
    };

    // InicializaciÃ³n
    async function init() {
      await window.dataSdk.init(dataHandler);
      window.elementSdk.init({
        defaultConfig,
        onConfigChange: async (config) => {
          document.body.style.backgroundColor = config.background_color;
          document.body.style.color = config.text_color;
          document.body.style.fontFamily = config.font_family;
          render();
        }
      });
      render();
    }

    function checkPendingReviews() {
      if (!currentUser || currentUser.role !== 'buyer') return;
      const pending = allOrders.find(o => o.buyer_username === currentUser.username && o.order_status === 'completed' && o.needs_review);
      if (pending) { selectedOrder = pending; showModal = 'review'; render(); }
    }

    // --- IMPORTAR / EXPORTAR ---
    async function exportData() {
        const d = JSON.stringify({users:allUsers, products:allProducts, orders:allOrders, reviews:allReviews, date:new Date()}, null, 2);
        try {
            await navigator.clipboard.writeText(d);
            showToast('âœ… Datos copiados al portapapeles');
        } catch(e) {
            const blob = new Blob([d], {type: 'application/json'});
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a'); a.href=url; a.download=`backup_${Date.now()}.json`;
            a.click();
        }
    }

    async function importData(e) {
        const f = e.target.files[0]; if(!f) return;
        const r = new FileReader();
        r.onload = async (ev) => {
            try {
                selectedOrder = JSON.parse(ev.target.result); 
                showModal='importConfirm'; 
                render();
            } catch(err) { showToast('âŒ Archivo invÃ¡lido'); }
        };
        r.readAsText(f);
    }

    async function confirmImport() {
        const d = selectedOrder;
        let count = 0;
        showToast('â³ Importando...');
        for(const u of d.users||[]) if(!allUsers.find(x=>x.username===u.username)) { delete u.__backendId; await window.dataSdk.create(u); count++; }
        for(const p of d.products||[]) { delete p.__backendId; await window.dataSdk.create(p); count++; }
        for(const o of d.orders||[]) { delete o.__backendId; await window.dataSdk.create(o); count++; }
        for(const r of d.reviews||[]) { delete r.__backendId; await window.dataSdk.create(r); count++; }
        showModal=null; showToast(`âœ… ${count} registros importados`); render();
    }

    // --- AUTENTICACIÃ“N ---
    async function handleLogin(e) {
      e.preventDefault();
      const u = document.getElementById('loginUsername').value.trim();
      const p = document.getElementById('loginPassword').value;
      
      if (u === ADMIN_CREDENTIALS.username && p === ADMIN_CREDENTIALS.password) {
        currentUser = { username: u, role: 'admin', __backendId: 'admin' };
        currentView = 'admin'; showModal = null; showToast('ğŸ‘‘ Bienvenido Admin'); updateUserActivity(); render(); return;
      }
      
      const user = allUsers.find(us => us.username === u && us.password === p);
      if (user) {
        if (user.status === 'banned') { selectedOrder=user; showModal='bannedInfo'; render(); return; }
        if (user.role === 'reseller' && !user.approved) return showToast('âš ï¸ Cuenta pendiente de aprobaciÃ³n');
        
        currentUser = user;
        if (user.role === 'reseller' && (!user.shop_name || !user.discord_tag)) { selectedOrder=user; showModal='setupShop'; render(); return; }
        
        showModal = null; 
        if (user.role !== 'buyer') currentView = 'admin';
        showToast(`ğŸ‘‹ Hola ${u}`); updateUserActivity(); render();
      } else { showToast('âŒ Datos incorrectos'); }
    }

    async function handleRegisterBuyer(e) {
      e.preventDefault();
      const u = document.getElementById('buyerUsername').value.trim();
      if(allUsers.find(x=>x.username===u)) return showToast('âš ï¸ Usuario ya existe');
      
      await window.dataSdk.create({
        id:Date.now().toString(), type:'user', username:u, 
        password:document.getElementById('buyerPassword').value,
        discord_tag:document.getElementById('buyerDiscord').value,
        role:'buyer', approved:true, status:'active', created_at:new Date().toISOString()
      });
      showToast('âœ… Registrado correctamente'); showModal='login'; render();
    }

    async function handleRegisterReseller(e) {
      e.preventDefault();
      const u = document.getElementById('resellerUsername').value.trim();
      if(allUsers.find(x=>x.username===u)) return showToast('âš ï¸ Usuario ya existe');
      
      await window.dataSdk.create({
        id:Date.now().toString(), type:'user', username:u,
        password:document.getElementById('resellerPassword').value,
        discord_tag:document.getElementById('resellerDiscord').value,
        shop_name:document.getElementById('resellerShop').value,
        role:'reseller', approved:false, status:'pending', created_at:new Date().toISOString()
      });
      showToast('âœ… Solicitud enviada al admin'); showModal=null; render();
    }

    async function updateUserActivity() {
        if(!currentUser) return;
        const act = window.currentData.find(i=>i.type==='activity' && i.username===currentUser.username);
        if(act) { act.last_activity=new Date().toISOString(); await window.dataSdk.update(act); }
        else await window.dataSdk.create({id:'act_'+currentUser.username, type:'activity', username:currentUser.username, last_activity:new Date().toISOString()});
        setTimeout(updateUserActivity, 120000);
    }

    function logout() { currentUser=null; currentView='catalog'; cart=[]; showToast('ğŸ‘‹ SesiÃ³n cerrada'); render(); }

    // --- CARRITO Y PEDIDOS ---
    function addToCart(bid) {
        if(!currentUser) { showModal='login'; render(); return showToast('âš ï¸ Inicia sesiÃ³n primero'); }
        const p = allProducts.find(x=>x.__backendId===bid);
        if(!p || p.stock<1) return showToast('âŒ Sin stock');
        
        const ex = cart.find(x=>x.__backendId===bid);
        if(ex) { 
            if(ex.quantity < p.stock) { ex.quantity++; showToast('â• Cantidad aumentada'); }
            else showToast('âš ï¸ Stock mÃ¡ximo alcanzado'); 
        } else { 
            cart.push({...p, quantity:1}); showToast('âœ… Agregado al carrito'); 
        }
        render();
    }
    
    function updateCartQuantity(idx, change) {
        const item = cart[idx];
        const p = allProducts.find(x=>x.__backendId===item.__backendId);
        if(!p) return;
        
        const newQty = item.quantity + change;
        if(newQty > 0 && newQty <= p.stock) { item.quantity = newQty; }
        else if(newQty <= 0) { removeFromCart(idx); return; }
        render();
    }

    function removeFromCart(idx) { cart.splice(idx,1); render(); }
    function clearCart() { cart=[]; render(); }
    
    async function createOrder() {
        if(cart.length===0) return;
        showToast('â³ Procesando pedido...');
        
        const sellers = {};
        cart.forEach(i => {
            if(!sellers[i.seller_username]) sellers[i.seller_username] = {items:[], total:0, discord:i.seller_discord};
            sellers[i.seller_username].items.push(i);
            sellers[i.seller_username].total += (i.discount>0?i.final_price:i.price)*i.quantity;
        });

        for(const s in sellers) {
            const info = sellers[s];
            await window.dataSdk.create({
                id:Date.now().toString()+'_'+s, type:'order',
                buyer_username:currentUser.username, buyer_discord:currentUser.discord_tag,
                seller_username:s, seller_discord:info.discord,
                items: info.items.map(x=>`${x.name} x${x.quantity}`).join(' | '),
                items_data: JSON.stringify(info.items.map(x=>({backendId:x.__backendId, quantity:x.quantity, name:x.name}))),
                total: info.total, order_status:'pending', seller_confirmed:false, buyer_confirmed:false, created_at:new Date().toISOString()
            });
        }
        cart=[]; currentView='orders'; showToast('âœ… Pedido creado con Ã©xito'); render();
    }

    async function confirmOrder(bid, isSeller) {
        const o = allOrders.find(x=>x.__backendId===bid);
        if(isSeller) o.seller_confirmed=true; else o.buyer_confirmed=true;
        
        if(o.seller_confirmed && o.buyer_confirmed) {
            o.order_status='completed'; o.needs_review=true;
            try {
                JSON.parse(o.items_data).forEach(async i => {
                    const p = allProducts.find(x=>x.__backendId===i.backendId);
                    if(p) { p.stock = Math.max(0, p.stock-i.quantity); await window.dataSdk.update(p); }
                });
            } catch(e){}
            showToast('âœ… Pedido completado');
        } else {
            showToast('âœ… ConfirmaciÃ³n registrada');
        }
        await window.dataSdk.update(o); render();
    }

    // --- PRODUCTOS Y ADMIN ---
    async function handleAddProduct(e) {
        e.preventDefault();
        const btn = e.target.querySelector('button');
        btn.disabled = true; btn.textContent = 'Guardando...';

        const p = {
            id:Date.now().toString(), type:'product',
            name:document.getElementById('productName').value,
            category:document.getElementById('productCategory').value,
            price:parseFloat(document.getElementById('productPrice').value),
            stock:parseInt(document.getElementById('productStock').value),
            description:document.getElementById('productDescription').value,
            image_url:document.getElementById('productImage').value,
            discount:parseInt(document.getElementById('productDiscount').value)||0,
            on_sale:document.getElementById('productOnSale').checked,
            seller_username:currentUser.username, 
            seller_shop_name:currentUser.shop_name || currentUser.username,
            seller_discord: currentUser.discord_tag,
            created_at:new Date().toISOString()
        };
        p.final_price = p.discount>0 ? p.price*(1-p.discount/100) : p.price;
        
        await window.dataSdk.create(p); 
        showToast('âœ… Producto agregado'); 
        e.target.reset();
        btn.disabled = false; btn.textContent = 'â• Agregar Producto';
    }

    async function deleteProduct(bid) { 
        if(confirm('Â¿Borrar producto?')) {
            await window.dataSdk.delete(allProducts.find(x=>x.__backendId===bid)); 
            showToast('ğŸ—‘ï¸ Producto eliminado'); 
        }
    }

    // --- GESTIÃ“N DE USUARIOS ---
    async function approveReseller(bid, ok) {
        const u=allUsers.find(x=>x.__backendId===bid); u.approved=ok; u.status=ok?'approved':'rejected';
        await window.dataSdk.update(u); render();
    }
    
    async function banUser(bid) { selectedOrder=allUsers.find(x=>x.__backendId===bid); showModal='banReason'; render(); }
    
    async function confirmBanUser() {
        selectedOrder.status='banned'; selectedOrder.banned_at=new Date().toISOString();
        selectedOrder.ban_reason=document.getElementById('banReason').value;
        selectedOrder.ban_motive=document.getElementById('banMotive').value;
        selectedOrder.banned_by=currentUser.username;
        await window.dataSdk.update(selectedOrder); showModal=null; showToast('ğŸš« Usuario baneado'); render();
    }
    
    async function unbanUser(bid) {
        const u = allUsers.find(x=>x.__backendId===bid);
        u.status = u.role==='reseller'?'approved':'active';
        u.ban_reason=null; u.ban_motive=null;
        await window.dataSdk.update(u); showToast('âœ… Usuario desbaneado');
    }

    async function deleteUser(bid) { selectedOrder=allUsers.find(x=>x.__backendId===bid); showModal='confirmDeleteUser'; render(); }
    
    async function confirmDeleteUser() {
        const u = selectedOrder;
        // Borrar sus productos
        const prods = allProducts.filter(p=>p.seller_username===u.username);
        for(const p of prods) await window.dataSdk.delete(p);
        await window.dataSdk.delete(u); 
        showModal=null; showToast('ğŸ—‘ï¸ Usuario y datos eliminados'); render();
    }
    
    async function handleSetupShop(e) {
        e.preventDefault();
        selectedOrder.shop_name = document.getElementById('setupShopName').value;
        selectedOrder.discord_tag = document.getElementById('setupDiscord').value;
        selectedOrder.role = 'reseller'; selectedOrder.approved = true;
        await window.dataSdk.update(selectedOrder);
        showModal=null; showToast('âœ… Tienda configurada'); render();
    }

    async function changeUserRole(bid, role) {
        const u = allUsers.find(x=>x.__backendId===bid);
        u.role = role; if(role==='reseller') { u.approved=true; u.shop_name=''; }
        await window.dataSdk.update(u); showToast(`Rol cambiado a ${role}`);
    }

    // --- RESEÃ‘AS ---
    async function handleSubmitReview(e) {
        e.preventDefault();
        const r = document.querySelector('input[name="rating"]:checked')?.value;
        if(!r) return showToast('âš ï¸ Elige una calificaciÃ³n');
        
        await window.dataSdk.create({
            id:Date.now().toString(), type:'review',
            buyer_username:currentUser.username, reviewed_seller:selectedOrder.seller_username,
            rating:parseInt(r), review_text:document.getElementById('reviewText').value,
            created_at:new Date().toISOString()
        });
        selectedOrder.needs_review=false; await window.dataSdk.update(selectedOrder);
        showModal=null; showToast('â­ ReseÃ±a enviada'); render();
    }

    function getSellerRating(s) {
        const r = allReviews.filter(x=>x.reviewed_seller===s);
        if(!r.length) return {avg:0, cnt:0};
        return {avg:(r.reduce((a,b)=>a+b.rating,0)/r.length).toFixed(1), cnt:r.length};
    }

    // --- RENDERIZADO Y UI ---
    function showToast(msg) {
        const t = document.createElement('div');
        t.className = 'fixed bottom-6 right-6 px-6 py-3 rounded-lg shadow-lg font-semibold z-50 text-white transition-all duration-500 transform translate-y-0 opacity-100';
        t.style.backgroundColor = getConfig().primary_button;
        t.textContent = msg; document.body.appendChild(t);
        setTimeout(()=>{ t.style.opacity='0'; t.style.transform='translateY(20px)'; }, 2500);
        setTimeout(()=>t.remove(),3000);
    }

    function getConfig() { return window.elementSdk.config || defaultConfig; }
    function getCurrentUserData() { return currentUser?.role==='admin' && currentUser.__backendId==='admin' ? currentUser : allUsers.find(u=>u.username===currentUser?.username); }
    function getCategoryIcon(id) { const c=CATEGORIES.find(x=>x.id===id); return c?c.icon:'ğŸ“¦'; }
    function getCategoryName(id) { const c=CATEGORIES.find(x=>x.id===id); return c?c.name:'Otro'; }
    function renderStars(n) { return 'â­'.repeat(Math.floor(n)) + (n%1>=0.5?'âœ¨':'') + 'â˜†'.repeat(5-Math.ceil(n)); }
    
    function filterUsers(term) {
        document.querySelectorAll('.user-row').forEach(r => {
            r.style.display = r.getAttribute('data-username').includes(term.toLowerCase()) ? '' : 'none';
        });
    }

    function render() {
        const app = document.getElementById('app');
        const cfg = getConfig();
        document.body.style.backgroundColor = cfg.background_color;
        document.body.style.color = cfg.text_color;

        if(currentView==='catalog') app.innerHTML = renderCatalog(cfg);
        else if(currentView==='cart') app.innerHTML = renderCart(cfg);
        else if(currentView==='orders') app.innerHTML = renderOrders(cfg);
        else if(currentView==='admin') app.innerHTML = renderAdmin(cfg);

        document.getElementById('modalContainer').innerHTML = showModal ? renderModal(cfg) : '';
    }

    function renderCatalog(cfg) {
        const prods = selectedCategory==='all'?allProducts : selectedCategory==='promotions'?allProducts.filter(p=>p.on_sale) : allProducts.filter(p=>p.category===selectedCategory);
        const tops = allUsers.filter(u=>u.role==='reseller'&&u.approved).map(u=>({...u, ...getSellerRating(u.username)})).sort((a,b)=>b.avg-a.avg).slice(0,3);
        const cartCnt = cart.reduce((a,b)=>a+b.quantity,0);

        return `
            <div class="pb-10">
                <header class="shadow-lg mb-6" style="background:${cfg.card_background}">
                    <div class="max-w-7xl mx-auto px-4 py-6 flex flex-col md:flex-row justify-between items-center gap-4">
                        <div><h1 class="text-3xl font-bold">${cfg.site_title}</h1><p class="opacity-80">${cfg.welcome_message}</p></div>
                        <div class="flex flex-wrap gap-2 justify-center">
                            ${currentUser ? `
                                <button onclick="currentView='cart';render()" class="px-4 py-2 rounded bg-blue-600 text-white relative">ğŸ›’ Carrito ${cartCnt>0?`<span class="cart-badge">${cartCnt}</span>`:''}</button>
                                <button onclick="currentView='orders';render()" class="px-4 py-2 rounded bg-purple-600 text-white">ğŸ“¦ Pedidos</button>
                                ${currentUser.role!=='buyer'?`<button onclick="currentView='admin';render()" class="px-4 py-2 rounded bg-green-600 text-white">${currentUser.role==='admin'?'âš™ï¸ Admin':'ğŸª Mi Tienda'}</button>`:''}
                                <button onclick="logout()" class="px-4 py-2 rounded bg-red-600 text-white">ğŸšª Salir</button>
                            ` : `
                                <button onclick="showModal='login';render()" class="px-4 py-2 rounded bg-blue-600 text-white">ğŸ” Entrar</button>
                                <button onclick="showModal='register';render()" class="px-4 py-2 rounded bg-green-600 text-white">ğŸ“ Registro</button>
                                <button onclick="showModal='registerReseller';render()" class="px-4 py-2 rounded bg-yellow-600 text-white">ğŸª Vender</button>
                            `}
                        </div>
                    </div>
                </header>
                ${tops.length?`<div class="max-w-7xl mx-auto mb-8 px-4"><h2 class="text-center text-xl font-bold mb-4">ğŸ† Top Tiendas</h2><div class="grid grid-cols-1 md:grid-cols-3 gap-4">${tops.map((t,i)=>`<div class="top-shop-card p-4 rounded text-center border border-white/10 bg-black/20"><div>${i===0?'ğŸ¥‡':i===1?'ğŸ¥ˆ':'ğŸ¥‰'}</div><div class="font-bold text-lg">${t.shop_name}</div><div class="text-yellow-400">${renderStars(t.avg)}</div></div>`).join('')}</div></div>`:''}
                
                <div class="max-w-7xl mx-auto px-4 flex gap-2 overflow-x-auto justify-center mb-8 pb-2">
                    ${CATEGORIES.map(c=>`<button onclick="selectedCategory='${c.id}';render()" class="category-btn px-6 py-2 rounded-full whitespace-nowrap shadow-md ${selectedCategory===c.id?'bg-blue-600 text-white ring-2 ring-white':'bg-gray-700 text-gray-300'}">${c.icon} ${c.name}</button>`).join('')}
                </div>
                
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 px-6 max-w-7xl mx-auto">
                    ${prods.length===0 ? `<div class="col-span-full text-center py-10 opacity-50">No hay productos en esta categorÃ­a</div>` : prods.map(p=>`
                        <div class="product-card rounded-xl overflow-hidden shadow-lg relative flex flex-col" style="background:${cfg.card_background}">
                            ${p.on_sale?'<span class="absolute top-2 right-2 bg-red-600 text-white text-xs font-bold px-2 py-1 rounded shadow-md z-10">ğŸ”¥ PROMO</span>':''}
                            <div class="h-48 bg-black/20 flex items-center justify-center text-5xl relative overflow-hidden">
                                ${p.image_url?`<img src="${p.image_url}" class="w-full h-full object-cover transition-transform duration-500 hover:scale-110" onerror="this.style.display='none';this.nextElementSibling.style.display='block'">`:''}
                                <span style="${p.image_url?'display:none':''}">${getCategoryIcon(p.category)}</span>
                            </div>
                            <div class="p-4 flex-1 flex flex-col">
                                <div class="flex justify-between items-start">
                                    <h3 class="font-bold text-lg truncate flex-1" title="${p.name}">${p.name}</h3>
                                </div>
                                <p class="text-xs opacity-60 mb-2">ğŸª ${p.seller_shop_name}</p>
                                <p class="text-sm opacity-80 line-clamp-2 mb-4 flex-1">${p.description}</p>
                                <div class="flex justify-between items-end mt-auto">
                                    <div>
                                        ${p.discount>0?`<span class="text-xs line-through opacity-50">$${p.price}</span>`:''}
                                        <div class="font-bold text-xl text-green-400">$${p.final_price}</div>
                                    </div>
                                    <button onclick="addToCart('${p.__backendId}')" ${p.stock<1?'disabled':''} class="px-4 py-2 rounded-lg bg-blue-600 text-white text-sm font-bold shadow disabled:opacity-50 hover:bg-blue-700 transition">${p.stock>0?'ğŸ›’':'âŒ'}</button>
                                </div>
                                <div class="text-xs text-right mt-1 opacity-50">Stock: ${p.stock}</div>
                            </div>
                        </div>
                    `).join('')}
                </div>
            </div>
        `;
    }

    function renderCart(cfg) {
        const total = cart.reduce((a,b)=>a+(b.discount>0?b.final_price:b.price)*b.quantity,0);
        return `
            <div class="p-6 max-w-4xl mx-auto min-h-screen">
                <div class="flex justify-between items-center mb-6"><h2 class="text-3xl font-bold">ğŸ›’ Mi Carrito</h2><button onclick="currentView='catalog';render()" class="text-blue-400 hover:underline">â† Volver</button></div>
                ${cart.length===0 ? `<div class="text-center py-10 opacity-50 text-xl">Tu carrito estÃ¡ vacÃ­o ğŸ•¸ï¸</div>` : `
                    <div class="space-y-4">
                    ${cart.map((i,idx)=>`
                        <div class="flex flex-col md:flex-row justify-between p-4 rounded-lg items-center shadow-md" style="background:${cfg.card_background}">
                            <div class="flex items-center gap-4 w-full md:w-auto">
                                <div class="text-3xl w-16 h-16 bg-black/20 rounded flex items-center justify-center">${i.image_url?`<img src="${i.image_url}" class="w-full h-full object-cover rounded">`:getCategoryIcon(i.category)}</div>
                                <div>
                                    <div class="font-bold text-lg">${i.name}</div>
                                    <div class="text-sm opacity-70">Vendedor: ${i.seller_shop_name}</div>
                                    <div class="text-green-400 font-bold">$${i.discount>0?i.final_price:i.price}</div>
                                </div>
                            </div>
                            <div class="flex items-center gap-4 mt-4 md:mt-0">
                                <div class="flex items-center bg-black/30 rounded-lg">
                                    <button onclick="updateCartQuantity(${idx},-1)" class="px-3 py-1 hover:bg-white/10 rounded-l">-</button>
                                    <span class="px-3 font-bold">${i.quantity}</span>
                                    <button onclick="updateCartQuantity(${idx},1)" class="px-3 py-1 hover:bg-white/10 rounded-r">+</button>
                                </div>
                                <div class="font-bold w-20 text-right">$${((i.discount>0?i.final_price:i.price)*i.quantity).toFixed(2)}</div>
                                <button onclick="removeFromCart(${idx})" class="text-red-500 hover:scale-110 transition">ğŸ—‘ï¸</button>
                            </div>
                        </div>
                    `).join('')}
                    </div>
                    <div class="mt-8 p-6 rounded-lg shadow-lg text-right" style="background:${cfg.card_background}">
                        <div class="text-2xl font-bold mb-4">Total: <span class="text-green-400">$${total.toFixed(2)} USDT</span></div>
                        <button onclick="createOrder()" class="w-full md:w-auto px-8 py-3 bg-green-600 hover:bg-green-700 rounded-lg text-white font-bold shadow-lg transition">âœ… Confirmar Pedido</button>
                    </div>
                `}
            </div>
        `;
    }

    function renderOrders(cfg) {
        const myOrders = allOrders.filter(o=>o.buyer_username===currentUser.username);
        return `
            <div class="p-6 max-w-4xl mx-auto min-h-screen">
                <div class="flex justify-between items-center mb-6"><h2 class="text-3xl font-bold">ğŸ“¦ Mis Pedidos</h2><button onclick="currentView='catalog';render()" class="text-blue-400 hover:underline">â† Volver</button></div>
                ${myOrders.length===0 ? `<div class="text-center py-10 opacity-50">No tienes pedidos aÃºn</div>` : myOrders.map(o=>`
                    <div class="p-6 rounded-lg mb-4 shadow-md border border-white/5" style="background:${cfg.card_background}">
                        <div class="flex justify-between items-start mb-4 border-b border-white/10 pb-2">
                            <div>
                                <span class="font-bold text-lg">#${o.id.slice(-5)}</span>
                                <span class="text-sm opacity-60 ml-2">${new Date(o.created_at).toLocaleDateString()}</span>
                            </div>
                            <span class="px-3 py-1 rounded-full text-xs font-bold ${o.order_status==='completed'?'bg-green-600':'bg-yellow-600'} text-white">${o.order_status==='completed'?'COMPLETADO':'PENDIENTE'}</span>
                        </div>
                        <div class="mb-4">
                            <div class="text-sm opacity-70">Vendedor: <span class="text-white font-bold">${o.seller_username}</span></div>
                            <div class="text-sm opacity-70">Discord: <span class="text-white font-bold select-all">${o.seller_discord}</span></div>
                            <div class="mt-2 p-3 bg-black/20 rounded text-sm font-mono">${o.items}</div>
                        </div>
                        <div class="flex justify-between items-center mt-4">
                            <div class="font-bold text-xl text-green-400">$${o.total.toFixed(2)}</div>
                            ${o.order_status==='pending' ? `
                                <div class="flex flex-col items-end gap-2">
                                    <div class="text-xs text-right">
                                        Vendedor: ${o.seller_confirmed?'âœ… Listo':'â³ Esperando'}<br>
                                        TÃº: ${o.buyer_confirmed?'âœ… Listo':'â³ Esperando'}
                                    </div>
                                    <button onclick="confirmOrder('${o.__backendId}',false)" ${o.buyer_confirmed?'disabled':''} class="px-4 py-2 bg-blue-600 hover:bg-blue-700 rounded text-white font-bold text-sm disabled:opacity-50">âœ… Confirmar Recibido</button>
                                </div>
                            ` : `<div class="text-green-400 font-bold">âœ… Finalizado</div>`}
                        </div>
                    </div>
                `).join('')}
            </div>
        `;
    }

    function renderAdmin(cfg) {
        const u = getCurrentUserData();
        const isA = u.role === 'admin';
        const items = isA ? allProducts : allProducts.filter(p => p.seller_username === u.username);
        const myOrders = isA ? allOrders : allOrders.filter(o=>o.seller_username===u.username);
        
        return `
            <div class="p-6 max-w-7xl mx-auto min-h-screen">
                <div class="flex justify-between items-center mb-8">
                    <h2 class="text-3xl font-bold flex items-center gap-2">${isA?'âš™ï¸ Panel Admin':'ğŸª GestiÃ³n de Tienda'}</h2>
                    <div class="flex gap-2">
                        <button onclick="currentView='catalog';render()" class="px-4 py-2 bg-gray-700 rounded hover:bg-gray-600">ğŸ  Inicio</button>
                        <button onclick="logout()" class="px-4 py-2 bg-red-600 rounded hover:bg-red-700">ğŸšª Salir</button>
                    </div>
                </div>

                ${isA ? `
                <div class="grid md:grid-cols-4 gap-4 mb-8">
                    <div class="p-4 rounded bg-blue-600/20 border border-blue-600/50 text-center">
                        <div class="text-2xl font-bold">${allUsers.length}</div>
                        <div class="text-sm opacity-70">Usuarios</div>
                    </div>
                    <div class="p-4 rounded bg-green-600/20 border border-green-600/50 text-center">
                        <div class="text-2xl font-bold">${allProducts.length}</div>
                        <div class="text-sm opacity-70">Productos</div>
                    </div>
                    <div class="p-4 rounded bg-yellow-600/20 border border-yellow-600/50 text-center">
                        <div class="text-2xl font-bold">${allOrders.filter(o=>o.order_status==='pending').length}</div>
                        <div class="text-sm opacity-70">Pedidos Pendientes</div>
                    </div>
                    <div class="p-4 rounded bg-purple-600/20 border border-purple-600/50 text-center">
                        <div class="flex flex-col gap-2">
                            <button onclick="exportData()" class="text-xs bg-purple-600 px-2 py-1 rounded hover:bg-purple-700">ğŸ’¾ Exportar JSON</button>
                            <label class="text-xs bg-blue-600 px-2 py-1 rounded hover:bg-blue-700 cursor-pointer">ğŸ“‚ Importar JSON<input type="file" hidden onchange="importData(event)"></label>
                        </div>
                    </div>
                </div>` : ''}

                <div class="grid lg:grid-cols-2 gap-8">
                    <div class="space-y-6">
                        <div class="p-6 rounded-xl shadow-lg" style="background:${cfg.card_background}">
                            <h3 class="font-bold text-xl mb-4">â• Publicar Producto</h3>
                            <div class="mb-4 p-3 bg-yellow-600/20 border border-yellow-600/50 rounded text-sm text-center">ğŸ’° ComisiÃ³n de la plataforma: 10%</div>
                            <form onsubmit="handleAddProduct(event)" class="space-y-3">
                                <input id="productName" placeholder="Nombre del Item" required class="w-full p-3 rounded bg-black/30 border border-white/10 focus:border-blue-500 outline-none">
                                <div class="flex gap-2">
                                    <select id="productCategory" class="w-1/2 p-3 rounded bg-black/30 border border-white/10 outline-none">
                                        <option value="items">âš”ï¸ Item</option>
                                        <option value="jewels">ğŸ’ Joya</option>
                                        <option value="wings">ğŸ¦… Alas</option>
                                        <option value="sets">ğŸ›¡ï¸ Set</option>
                                    </select>
                                    <input id="productPrice" type="number" step="0.01" placeholder="Precio USDT" required class="w-1/2 p-3 rounded bg-black/30 border border-white/10 outline-none">
                                </div>
                                <div class="flex gap-2">
                                    <input id="productStock" type="number" placeholder="Stock" required class="w-1/2 p-3 rounded bg-black/30 border border-white/10 outline-none">
                                    <input id="productDiscount" type="number" placeholder="% Desc." class="w-1/2 p-3 rounded bg-black/30 border border-white/10 outline-none">
                                </div>
                                <input id="productImage" placeholder="URL Imagen (Opcional)" class="w-full p-3 rounded bg-black/30 border border-white/10 outline-none">
                                <textarea id="productDescription" placeholder="DescripciÃ³n detallada..." class="w-full p-3 rounded bg-black/30 border border-white/10 outline-none h-20"></textarea>
                                <label class="flex items-center gap-2 cursor-pointer"><input type="checkbox" id="productOnSale" class="w-5 h-5"> ğŸ”¥ Marcar como Oferta Especial</label>
                                <button class="w-full py-3 bg-green-600 hover:bg-green-700 rounded font-bold text-white shadow-lg transition">â• Agregar Producto</button>
                            </form>
                        </div>
                    </div>

                    <div class="space-y-6">
                        <div class="p-6 rounded-xl shadow-lg max-h-96 overflow-y-auto" style="background:${cfg.card_background}">
                            <h3 class="font-bold text-xl mb-4">ğŸ“¦ Inventario (${items.length})</h3>
                            ${items.map(p=>`
                                <div class="flex justify-between items-center mb-2 p-3 bg-black/20 rounded hover:bg-black/30 transition">
                                    <div class="flex items-center gap-3">
                                        <div class="text-2xl">${getCategoryIcon(p.category)}</div>
                                        <div>
                                            <div class="font-bold">${p.name}</div>
                                            <div class="text-xs opacity-60">Stock: ${p.stock} | $${p.final_price}</div>
                                        </div>
                                    </div>
                                    <button onclick="deleteProduct('${p.__backendId}')" class="text-red-500 hover:bg-red-500/20 p-2 rounded transition">ğŸ—‘ï¸</button>
                                </div>
                            `).join('')}
                        </div>

                        <div class="p-6 rounded-xl shadow-lg max-h-96 overflow-y-auto" style="background:${cfg.card_background}">
                            <h3 class="font-bold text-xl mb-4">ğŸ“¥ Pedidos Entrantes</h3>
                            ${myOrders.map(o=>`
                                <div class="mb-3 p-3 bg-black/20 rounded border-l-4 ${o.order_status==='completed'?'border-green-500':'border-yellow-500'}">
                                    <div class="flex justify-between text-sm font-bold">
                                        <span>#${o.id.slice(-4)} - ${o.buyer_username}</span>
                                        <span class="${o.order_status==='completed'?'text-green-400':'text-yellow-400'}">$${o.total}</span>
                                    </div>
                                    <div class="text-xs opacity-70 mt-1">${o.items}</div>
                                    ${o.order_status==='pending' ? `
                                        <button onclick="confirmOrder('${o.__backendId}',true)" ${o.seller_confirmed?'disabled':''} class="mt-2 w-full py-1 bg-blue-600 rounded text-xs font-bold hover:bg-blue-700 disabled:opacity-50">${o.seller_confirmed?'âœ… Esperando comprador':'âœ… Confirmar Entrega'}</button>
                                    `:''}
                                </div>
                            `).join('')}
                        </div>
                    </div>
                </div>

                ${isA ? `
                <div class="mt-8 p-6 rounded-xl shadow-lg" style="background:${cfg.card_background}">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="font-bold text-xl">ğŸ‘¥ GestiÃ³n de Usuarios</h3>
                        <input oninput="filterUsers(this.value)" placeholder="ğŸ” Buscar..." class="p-2 rounded bg-black/30 border border-white/10 text-sm w-64">
                    </div>
                    <div class="max-h-96 overflow-y-auto">
                        ${allUsers.map(u=>`
                            <div class="user-row flex flex-wrap justify-between items-center mb-2 p-3 bg-black/20 rounded hover:bg-black/30 transition" data-username="${u.username.toLowerCase()}">
                                <div class="flex items-center gap-3 min-w-[200px]">
                                    <div class="w-2 h-2 rounded-full ${onlineUsers.has(u.username)?'bg-green-500':'bg-gray-500'}"></div>
                                    <div>
                                        <div class="font-bold ${u.status==='banned'?'text-red-500 line-through':''}">${u.username}</div>
                                        <div class="text-xs opacity-60">${u.role} | ${u.discord_tag||'-'}</div>
                                    </div>
                                </div>
                                <div class="flex gap-2 text-xs items-center">
                                    ${u.role==='reseller' ? (u.approved ? '<span class="text-green-400">âœ… Aprobado</span>' : `<button onclick="approveReseller('${u.__backendId}',true)" class="bg-green-600 px-2 py-1 rounded">Aprobar</button>`) : ''}
                                    <select onchange="changeUserRole('${u.__backendId}',this.value)" class="bg-black/40 rounded p-1">
                                        <option value="buyer" ${u.role==='buyer'?'selected':''}>Buyer</option>
                                        <option value="reseller" ${u.role==='reseller'?'selected':''}>Seller</option>
                                        <option value="admin" ${u.role==='admin'?'selected':''}>Admin</option>
                                    </select>
                                    ${u.status==='banned' ? 
                                        `<button onclick="unbanUser('${u.__backendId}')" class="bg-gray-600 px-2 py-1 rounded">Desbanear</button>` : 
                                        `<button onclick="banUser('${u.__backendId}')" class="bg-orange-600 px-2 py-1 rounded">Ban</button>`
                                    }
                                    <button onclick="deleteUser('${u.__backendId}')" class="bg-red-600 px-2 py-1 rounded">Del</button>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>` : ''}
            </div>
        `;
    }

    // --- MODALES ---
    function renderModal(cfg) {
        const wrap = (c) => `<div class="fixed inset-0 modal-backdrop flex items-center justify-center z-50 p-4 anim-fade-in" onclick="if(event.target===this){showModal=null;render();}"><div class="rounded-xl p-8 max-w-md w-full relative shadow-2xl" style="background:${cfg.card_background}">${c}</div></div>`;
        
        if(showModal==='login') return wrap(`
            <h2 class="text-3xl font-bold mb-6 text-center">ğŸ” Acceso</h2>
            <form onsubmit="handleLogin(event)" class="space-y-4">
                <input id="loginUsername" placeholder="Usuario" class="w-full p-3 rounded bg-black/30 border border-white/10 focus:border-blue-500 outline-none">
                <input type="password" id="loginPassword" placeholder="ContraseÃ±a" class="w-full p-3 rounded bg-black/30 border border-white/10 focus:border-blue-500 outline-none">
                <button class="w-full bg-blue-600 hover:bg-blue-700 p-3 rounded text-white font-bold shadow-lg transition">Entrar</button>
                <div class="text-center text-sm mt-4 pt-4 border-t border-white/10">
                    <p class="opacity-60 mb-2">Â¿Nuevo aquÃ­?</p>
                    <div class="flex justify-center gap-4">
                        <button type="button" onclick="showModal='register';render()" class="text-green-400 hover:underline">Crear Cuenta</button>
                        <button type="button" onclick="showModal='registerReseller';render()" class="text-yellow-400 hover:underline">Quiero Vender</button>
                    </div>
                </div>
            </form>
        `);
        
        if(showModal==='register') return wrap(`<h2 class="text-2xl font-bold mb-4 text-center">ğŸ“ Registro Comprador</h2><form onsubmit="handleRegisterBuyer(event)" class="space-y-4"><input id="buyerUsername" placeholder="Usuario" class="w-full p-3 rounded bg-black/30 border border-white/10"><input type="password" id="buyerPassword" placeholder="ContraseÃ±a" class="w-full p-3 rounded bg-black/30 border border-white/10"><input id="buyerDiscord" placeholder="Discord Tag" class="w-full p-3 rounded bg-black/30 border border-white/10"><button class="w-full bg-green-600 p-3 rounded font-bold hover:bg-green-700 transition">Registrar</button></form>`);
        
        if(showModal==='registerReseller') return wrap(`<h2 class="text-2xl font-bold mb-4 text-center">ğŸª Solicitud Vendedor</h2><form onsubmit="handleRegisterReseller(event)" class="space-y-4"><input id="resellerUsername" placeholder="Usuario" class="w-full p-3 rounded bg-black/30 border border-white/10"><input type="password" id="resellerPassword" placeholder="ContraseÃ±a" class="w-full p-3 rounded bg-black/30 border border-white/10"><input id="resellerShop" placeholder="Nombre Tienda" class="w-full p-3 rounded bg-black/30 border border-white/10"><input id="resellerDiscord" placeholder="Discord Tag" class="w-full p-3 rounded bg-black/30 border border-white/10"><div class="bg-yellow-600/20 p-3 rounded text-xs text-center">âš ï¸ Requiere aprobaciÃ³n del Admin</div><button class="w-full bg-yellow-600 p-3 rounded font-bold hover:bg-yellow-700 transition">Enviar Solicitud</button></form>`);

        if(showModal==='review') return wrap(`<h2 class="text-xl font-bold mb-4 text-center">â­ Califica tu compra</h2><form onsubmit="handleSubmitReview(event)"><div class="flex justify-center gap-4 text-4xl mb-6">${[1,2,3,4,5].map(n=>`<label class="cursor-pointer hover:scale-125 transition"><input type="radio" name="rating" value="${n}" class="hidden"><span onclick="this.parentNode.querySelector('input').checked=true">â­</span></label>`).join('')}</div><textarea id="reviewText" class="w-full p-3 bg-black/30 border border-white/10 rounded mb-4 h-24" placeholder="Â¿QuÃ© tal fue el servicio?"></textarea><button class="w-full bg-green-600 p-3 rounded font-bold hover:bg-green-700">Enviar CalificaciÃ³n</button></form>`);
        
        if(showModal==='banReason') return wrap(`<h2 class="text-xl text-red-500 font-bold mb-4">ğŸš« Banear Usuario</h2><input id="banReason" placeholder="RazÃ³n (Ej: Estafa)" class="w-full p-3 rounded bg-black/30 border border-white/10 mb-3"><textarea id="banMotive" placeholder="Detalles adicionales..." class="w-full p-3 rounded bg-black/30 border border-white/10 mb-4 h-24"></textarea><button onclick="confirmBanUser()" class="w-full bg-red-600 p-3 rounded font-bold hover:bg-red-700">Confirmar Baneo</button>`);

        if(showModal==='bannedInfo') return wrap(`<div class="text-center"><div class="text-6xl mb-4">ğŸš«</div><h3 class="text-2xl font-bold text-red-500 mb-4">Cuenta Suspendida</h3><div class="bg-red-900/30 p-4 rounded mb-6 border border-red-500/30"><p class="font-bold text-lg mb-2">${selectedOrder.ban_reason}</p><p class="opacity-80">${selectedOrder.ban_motive}</p></div><button onclick="showModal=null;render()" class="px-6 py-2 bg-gray-600 rounded hover:bg-gray-700">Cerrar</button></div>`);
        
        if(showModal==='setupShop') return wrap(`<h2 class="text-xl font-bold mb-4">ğŸª Configura tu Tienda</h2><p class="text-sm opacity-70 mb-4">Necesitamos estos datos para que puedas vender.</p><form onsubmit="handleSetupShop(event)"><input id="setupShopName" placeholder="Nombre de tu Tienda" class="w-full p-3 rounded bg-black/30 border border-white/10 mb-3" required><input id="setupDiscord" value="${selectedOrder.discord_tag||''}" placeholder="Discord Tag" class="w-full p-3 rounded bg-black/30 border border-white/10 mb-4" required><button class="w-full bg-blue-600 p-3 rounded font-bold hover:bg-blue-700">Guardar y Empezar</button></form>`);
        
        if(showModal==='importConfirm') return wrap(`<h2 class="text-xl font-bold mb-4">ğŸ“¥ Confirmar ImportaciÃ³n</h2><p class="mb-4 opacity-80">Se cargarÃ¡n los datos del archivo. Esto aÃ±adirÃ¡ usuarios y productos nuevos.</p><div class="bg-blue-600/20 p-3 rounded mb-4 text-sm">Productos: ${selectedOrder.products?.length||0}<br>Usuarios: ${selectedOrder.users?.length||0}</div><button onclick="confirmImport()" class="w-full bg-green-600 p-3 rounded font-bold hover:bg-green-700">Confirmar</button>`);
        
        if(showModal==='confirmDeleteUser') return wrap(`<h2 class="text-xl font-bold text-red-500 mb-4">âš ï¸ Eliminar Usuario</h2><p class="mb-4">Â¿EstÃ¡s seguro? Se borrarÃ¡n <strong>todos</strong> sus productos, pedidos y datos. Esta acciÃ³n no se puede deshacer.</p><button onclick="confirmDeleteUser()" class="w-full bg-red-600 p-3 rounded font-bold hover:bg-red-700">SÃ­, eliminar todo</button><button onclick="showModal=null;render()" class="w-full mt-2 p-2 opacity-60 hover:opacity-100">Cancelar</button>`);

        return '';
    }

    // Iniciar App
    init();
  </script>
</body>
</html>

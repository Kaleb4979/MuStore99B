<!doctype html>
<html lang="es">
<head>
Â  <meta charset="UTF-8">
Â  <meta name="viewport" content="width=device-width, initial-scale=1.0">
Â  <title>Mu Online 99B Marketplace</title>
Â  
Â  <script src="https://cdn.tailwindcss.com"></script>
Â  
Â  <link rel="preconnect" href="https://fonts.googleapis.com">
Â  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
Â  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&amp;display=swap" rel="stylesheet">
Â  
Â  <style>
Â  Â  body {
Â  Â  Â  box-sizing: border-box;
Â  Â  Â  margin: 0;
Â  Â  Â  padding: 0;
Â  Â  Â  height: 100%;
Â  Â  Â  font-family: 'Inter', sans-serif;
Â  Â  }
Â  Â  html {
Â  Â  Â  height: 100%;
Â  Â  }
Â  Â  .category-btn {
Â  Â  Â  transition: all 0.3s ease;
Â  Â  }
Â  Â  .category-btn:hover {
Â  Â  Â  transform: translateY(-2px);
Â  Â  }
Â  Â  .product-card {
Â  Â  Â  transition: all 0.3s ease;
Â  Â  }
Â  Â  .product-card:hover {
Â  Â  Â  transform: translateY(-5px);
Â  Â  Â  box-shadow: 0 10px 25px rgba(0,0,0,0.3);
Â  Â  }
Â  Â  .loading-spinner {
Â  Â  Â  border: 3px solid rgba(255,255,255,0.3);
Â  Â  Â  border-top: 3px solid white;
Â  Â  Â  border-radius: 50%;
Â  Â  Â  width: 20px;
Â  Â  Â  height: 20px;
Â  Â  Â  animation: spin 1s linear infinite;
Â  Â  }
Â  Â  @keyframes spin {
Â  Â  Â  0% { transform: rotate(0deg); }
Â  Â  Â  100% { transform: rotate(360deg); }
Â  Â  }
Â  Â  .cart-badge {
Â  Â  Â  position: absolute;
Â  Â  Â  top: -8px;
Â  Â  Â  right: -8px;
Â  Â  Â  background-color: #ef4444;
Â  Â  Â  color: white;
Â  Â  Â  border-radius: 50%;
Â  Â  Â  width: 24px;
Â  Â  Â  height: 24px;
Â  Â  Â  display: flex;
Â  Â  Â  align-items: center;
Â  Â  Â  justify-content: center;
Â  Â  Â  font-size: 12px;
Â  Â  Â  font-weight: bold;
Â  Â  }
Â  Â  .modal-backdrop {
Â  Â  Â  background-color: rgba(0, 0, 0, 0.7);
Â  Â  }
Â  Â  .btn-primary {
Â  Â  Â  transition: all 0.2s ease;
Â  Â  }
Â  Â  .btn-primary:hover {
Â  Â  Â  transform: scale(1.05);
Â  Â  }
Â  Â  .star-rating {
Â  Â  Â  display: flex;
Â  Â  Â  justify-content: center;
Â  Â  Â  flex-direction: row-reverse; /* Revertir el orden para que la primera estrella sea la 5 */
Â  Â  }
Â  Â  .star-rating > label {
Â  Â  Â  cursor: pointer;
Â  Â  Â  transition: all 0.2s ease;
Â  Â  }
Â  Â  .star-rating > label:before {
Â  Â  Â  content: 'â˜…';
Â  Â  Â  color: #ccc;
Â  Â  Â  font-size: 40px;
Â  Â  }
Â  Â  .star-rating > input:checked ~ label:before,
Â  Â  .star-rating > label:hover ~ label:before,
Â  Â  .star-rating > label:hover:before {
Â  Â  Â  color: #FFD700; /* Color dorado */
Â  Â  }
Â  Â  .top-shop-card {
Â  Â  Â  transition: all 0.3s ease;
Â  Â  }
Â  Â  .top-shop-card:hover {
Â  Â  Â  transform: translateX(5px);
Â  Â  }
Â  </style>
Â  <style>@view-transition { navigation: auto; }</style>

Â  <script>
Â  Â  const DB_KEY = 'mu_marketplace_db_v2'; // Actualizado version DB

Â  Â  // Inicializar DB en memoria desde LocalStorage o vacÃ­o
Â  Â  let savedData = localStorage.getItem(DB_KEY);
Â  Â  window.mockDb = {
Â  Â  Â  data: savedData ? JSON.parse(savedData) : [],
Â  Â  Â  handler: null,
Â  Â  Â  notify() {
Â  Â  Â  Â  // Guardar en LocalStorage cada vez que hay cambios
Â  Â  Â  Â  localStorage.setItem(DB_KEY, JSON.stringify(this.data));
Â  Â  Â  Â  if (this.handler) this.handler.onDataChanged(this.data);
Â  Â  Â  }
Â  Â  };

Â  Â  // Simular Data SDK
Â  Â  window.dataSdk = {
Â  Â  Â  init: async (handler) => {
Â  Â  Â  Â  window.mockDb.handler = handler;
Â  Â  Â  Â  // Notificar datos iniciales. (setTimeout simula la latencia de una API real)
Â  Â  Â  Â  setTimeout(() => window.mockDb.notify(), 50);Â 
Â  Â  Â  Â  return { isOk: true };
Â  Â  Â  },
Â  Â  Â  create: async (item) => {
Â  Â  Â  Â  item.__backendId = Date.now().toString() + Math.random().toString(36).substr(2, 9);
Â  Â  Â  Â  window.mockDb.data.push(item);
Â  Â  Â  Â  window.mockDb.notify();
Â  Â  Â  Â  return { isOk: true, item: item }; // Agregado item para consistencia
Â  Â  Â  },
Â  Â  Â  update: async (item) => {
Â  Â  Â  Â  const index = window.mockDb.data.findIndex(i => i.__backendId === item.__backendId);
Â  Â  Â  Â  if (index !== -1) {
Â  Â  Â  Â  Â  window.mockDb.data[index] = item;
Â  Â  Â  Â  Â  window.mockDb.notify();
Â  Â  Â  Â  Â  return { isOk: true, item: item }; // Agregado item para consistencia
Â  Â  Â  Â  }
Â  Â  Â  Â  return { isOk: false };
Â  Â  Â  },
Â  Â  Â  delete: async (item) => {
Â  Â  Â  Â  window.mockDb.data = window.mockDb.data.filter(i => i.__backendId !== item.__backendId);
Â  Â  Â  Â  window.mockDb.notify();
Â  Â  Â  Â  return { isOk: true };
Â  Â  Â  }
Â  Â  };

Â  Â  // Simular Element SDK (ConfiguraciÃ³n visual)
Â  Â  window.elementSdk = {
Â  Â  Â  config: {},
Â  Â  Â  init: (options) => {
Â  Â  Â  Â  window.elementSdk.config = options.defaultConfig;
Â  Â  Â  Â  if(options.onConfigChange) options.onConfigChange(options.defaultConfig);
Â  Â  Â  },
Â  Â  Â  setConfig: (newConfig) => {
Â  Â  Â  Â  window.elementSdk.config = { ...window.elementSdk.config, ...newConfig };
Â  Â  Â  }
Â  Â  };
Â  </script>
</head>
<body>
Â  <div id="app" class="min-h-full">
Â  Â  Â  Â  <div id="loading-initial" class="flex items-center justify-center min-h-screen" style="background-color: #0f172a; color: #f1f5f9;">
Â  Â  Â  <div class="text-center">
Â  Â  Â  Â  <div class="loading-spinner mx-auto mb-4"></div>
Â  Â  Â  Â  <p>Cargando datos del Marketplace...</p>
Â  Â  Â  </div>
Â  Â  </div>
Â  </div>
Â  
Â  <script>
Â  Â  const defaultConfig = {
Â  Â  Â  site_title: "Mu Online 99B Marketplace",
Â  Â  Â  welcome_message: "Bienvenido a nuestra tienda de items premium",
Â  Â  Â  contact_info: "Contacto: Discord/WhatsApp",
Â  Â  Â  background_color: "#0f172a",
Â  Â  Â  card_background: "#1e293b",
Â  Â  Â  text_color: "#f1f5f9",
Â  Â  Â  primary_button: "#3b82f6",
Â  Â  Â  secondary_button: "#10b981",
Â  Â  Â  font_family: "Inter",
Â  Â  Â  font_size: 16
Â  Â  };

Â  Â  let currentUser = null;
Â  Â  let currentView = 'catalog';
Â  Â  let selectedCategory = 'all';
Â  Â  let allProducts = [];
Â  Â  let allUsers = [];
Â  Â  let allOrders = [];
Â  Â  let allReviews = [];
Â  Â  let cart = JSON.parse(localStorage.getItem('mu_cart_v2') || '[]'); // Mantener carrito en localStorage
Â  Â  let showModal = null;
Â  Â  let selectedOrder = null;

Â  Â  const CATEGORIES = [
Â  Â  Â  { id: 'all', name: 'Todos', icon: 'ğŸ®' },
Â  Â  Â  { id: 'promotions', name: 'Promociones', icon: 'ğŸ”¥' },
Â  Â  Â  { id: 'items', name: 'Items', icon: 'âš”ï¸' },
Â  Â  Â  { id: 'jewels', name: 'Joyas', icon: 'ğŸ’' },
Â  Â  Â  { id: 'wings', name: 'Alas', icon: 'ğŸ¦…' },
Â  Â  Â  { id: 'sets', name: 'Sets', icon: 'ğŸ›¡ï¸' }
Â  Â  ];

Â  Â  const ADMIN_CREDENTIALS = {
Â  Â  Â  username: 'Kaleb',
Â  Â  Â  password: 'Kaleb.2021'
Â  Â  };

Â  Â  let onlineUsers = new Set();
Â  Â  let userActivityTimeout = null;
Â  Â  let isReviewModalOpen = false; // Bandera para controlar la apertura del modal de reseÃ±a

Â  Â  // Data SDK Handler
Â  Â  const dataHandler = {
Â  Â  Â  onDataChanged(data) {
Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  allProducts = data.filter(item => item.type === 'product') || [];
Â  Â  Â  Â  Â  allUsers = data.filter(item => item.type === 'user') || [];
Â  Â  Â  Â  Â  allOrders = data.filter(item => item.type === 'order') || [];
Â  Â  Â  Â  Â  allReviews = data.filter(item => item.type === 'review') || [];
Â  Â  Â  Â  Â  const activityRecords = data.filter(item => item.type === 'activity') || [];
Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  // Actualizar usuarios en lÃ­nea (Ãºltimos 5 minutos)
Â  Â  Â  Â  Â  const fiveMinutesAgo = Date.now() - (5 * 60 * 1000);
Â  Â  Â  Â  Â  onlineUsers = new Set(
Â  Â  Â  Â  Â  Â  activityRecords
Â  Â  Â  Â  Â  Â  Â  .filter(a => new Date(a.last_activity).getTime() > fiveMinutesAgo)
Â  Â  Â  Â  Â  Â  Â  .map(a => a.username)
Â  Â  Â  Â  Â  );
Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  checkPendingReviews();
Â  Â  Â  Â  Â  render();
Â  Â  Â  Â  } catch (error) {
Â  Â  Â  Â  Â  console.error("Error en onDataChanged:", error);
Â  Â  Â  Â  Â  document.getElementById('app').innerHTML = `<div class="text-center p-20 text-red-500" style="background-color: #0f172a; color: #f1f5f9;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h1 class="text-2xl font-bold">âŒ Error CrÃ­tico al Procesar Datos</h1>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="mt-4">Revise la consola del navegador para detalles. El error es: ${error.message}</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>`;
Â  Â  Â  Â  }
Â  Â  Â  }
Â  Â  };

Â  Â  // Initialize
Â  Â  async function init() {
Â  Â  Â  try {
Â  Â  Â  Â  const initResult = await window.dataSdk.init(dataHandler);
Â  Â  Â  Â  
Â  Â  Â  Â  if (!initResult.isOk) {
Â  Â  Â  Â  Â  throw new Error("Data SDK no pudo inicializarse.");
Â  Â  Â  Â  }
Â  Â  Â  Â  
Â  Â  Â  Â  if (window.elementSdk) {
Â  Â  Â  Â  Â  window.elementSdk.init({
Â  Â  Â  Â  Â  Â  defaultConfig,
Â  Â  Â  Â  Â  Â  onConfigChange: async (config) => {
Â  Â  Â  Â  Â  Â  Â  document.body.style.backgroundColor = config.background_color || defaultConfig.background_color;
Â  Â  Â  Â  Â  Â  Â  document.body.style.color = config.text_color || defaultConfig.text_color;
Â  Â  Â  Â  Â  Â  Â  const baseSize = config.font_size || defaultConfig.font_size;
Â  Â  Â  Â  Â  Â  Â  document.body.style.fontSize = `${baseSize}px`;
Â  Â  Â  Â  Â  Â  Â  render();
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  });
Â  Â  Â  Â  }
Â  Â  Â  Â  
Â  Â  Â  } catch (error) {
Â  Â  Â  Â  console.error("Error en la inicializaciÃ³n (init):", error);
Â  Â  Â  Â  const app = document.getElementById('app');
Â  Â  Â  Â  app.innerHTML = `<div class="text-center p-20 text-red-500" style="background-color: ${defaultConfig.background_color}; color: ${defaultConfig.text_color};">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h1 class="text-2xl font-bold">âŒ Error al Inicializar el Sistema</h1>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="mt-4">El sistema fallÃ³ al arrancar. Por favor, revisa la consola del navegador (F12) para ver el error exacto y compÃ¡rtelo.</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-sm mt-2">Error: ${error.message}</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>`;
Â  Â  Â  }
Â  Â  }

Â  Â  // Verificar pedidos pendientes de calificar
Â  Â  function checkPendingReviews() {
Â  Â  Â  if (!currentUser || currentUser.role !== 'buyer' || isReviewModalOpen) return;
Â  Â  Â  
Â  Â  Â  const pendingOrder = allOrders.find(o =>Â 
Â  Â  Â  Â  o.buyer_username === currentUser.username &&Â 
Â  Â  Â  Â  o.order_status === 'completed' &&Â 
Â  Â  Â  Â  o.needs_review === true
Â  Â  Â  );

Â  Â  Â  if (pendingOrder) {
Â  Â  Â  Â  selectedOrder = pendingOrder;
Â  Â  Â  Â  showModal = 'review';
Â  Â  Â  Â  isReviewModalOpen = true; // Establecer bandera
Â  Â  Â  }
Â  Â  }

Â  Â  // Export/Import Functions
Â  Â  async function exportData() {
Â  Â  Â  const btn = event?.target;
Â  Â  Â  if (btn) {
Â  Â  Â  Â  btn.disabled = true;
Â  Â  Â  Â  btn.innerHTML = '<div class="loading-spinner mx-auto"></div>';
Â  Â  Â  }

Â  Â  Â  const exportData = {
Â  Â  Â  Â  products: allProducts,
Â  Â  Â  Â  users: allUsers,
Â  Â  Â  Â  orders: allOrders,
Â  Â  Â  Â  reviews: allReviews,
Â  Â  Â  Â  exportDate: new Date().toISOString(),
Â  Â  Â  Â  version: '1.0'
Â  Â  Â  };

Â  Â  Â  const dataStr = JSON.stringify(exportData, null, 2);
Â  Â  Â  
Â  Â  Â  try {
Â  Â  Â  Â  const blob = new Blob([dataStr], { type: 'application/json' });
Â  Â  Â  Â  const url = URL.createObjectURL(blob);
Â  Â  Â  Â  const a = document.createElement('a');
Â  Â  Â  Â  a.href = url;
Â  Â  Â  Â  a.download = `marketplace_backup_${new Date().toISOString().split('T')[0]}.json`;
Â  Â  Â  Â  a.style.display = 'none';
Â  Â  Â  Â  document.body.appendChild(a);
Â  Â  Â  Â  a.click();
Â  Â  Â  Â  
Â  Â  Â  Â  setTimeout(() => {
Â  Â  Â  Â  Â  document.body.removeChild(a);
Â  Â  Â  Â  Â  URL.revokeObjectURL(url);
Â  Â  Â  Â  }, 100);
Â  Â  Â  Â  
Â  Â  Â  Â  showToast('âœ… Descargando archivo JSON...');
Â  Â  Â  } catch (error) {
Â  Â  Â  Â  showToast('âŒ Error al descargar.');
Â  Â  Â  }

Â  Â  Â  if (btn) {
Â  Â  Â  Â  btn.disabled = false;
Â  Â  Â  Â  btn.innerHTML = 'ğŸ“¥ Exportar Todos los Datos';
Â  Â  Â  }
Â  Â  }

Â  Â  async function importData(event) {
Â  Â  Â  const file = event.target.files[0];
Â  Â  Â  if (!file) return;

Â  Â  Â  const reader = new FileReader();
Â  Â  Â  reader.onload = async (e) => {
Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  const importedData = JSON.parse(e.target.result);
Â  Â  Â  Â  Â  if (!importedData.products && !importedData.users) { // Check relajado para permitir parciales
Â  Â  Â  Â  Â  Â  showToast('âŒ Archivo JSON invÃ¡lido');
Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  showModal = 'importConfirm';
Â  Â  Â  Â  Â  selectedOrder = importedData; // Uso temporal de variable
Â  Â  Â  Â  Â  render();
Â  Â  Â  Â  } catch (error) {
Â  Â  Â  Â  Â  showToast('âŒ Error al leer el archivo JSON');
Â  Â  Â  Â  }
Â  Â  Â  };
Â  Â  Â  reader.readAsText(file);
Â  Â  Â  event.target.value = '';
Â  Â  }

Â  Â  async function confirmImport() {
Â  Â  Â  const importedData = selectedOrder;
Â  Â  Â  if (!importedData) return;

Â  Â  Â  const btn = document.getElementById('confirmImportBtn');
Â  Â  Â  if(btn) {
Â  Â  Â  Â  btn.innerHTML = '<div class="loading-spinner mx-auto"></div> Importando...';
Â  Â  Â  Â  btn.disabled = true;
Â  Â  Â  }

Â  Â  Â  // Import logic (Iterate via DataSDK to trigger Updates)
Â  Â  Â  // ATENCIÃ“N: Esta implementaciÃ³n es para LocalStorage mock, NO para JSONBin.
Â  Â  Â  // Para evitar duplicados en LocalStorage, limpiamos y re-insertamos.
Â  Â  Â  
Â  Â  Â  const newFullData = [];
Â  Â  Â  const collections = ['users', 'products', 'orders', 'reviews', 'activity'];
Â  Â  Â  
Â  Â  Â  for (const col of collections) {
Â  Â  Â  Â  Â  if(importedData[col]) {
Â  Â  Â  Â  Â  Â  Â  for(const item of importedData[col]) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  // Regenerar __backendId por si se importan datos de otra fuente/sesiÃ³n
Â  Â  Â  Â  Â  Â  Â  Â  Â  item.__backendId = item.__backendId || (Date.now().toString() + Math.random().toString(36).substr(2, 9));
Â  Â  Â  Â  Â  Â  Â  Â  Â  newFullData.push(item);
Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  }
Â  Â  Â  }
Â  Â  Â  
Â  Â  Â  // Reemplazar la data en memoria y notificar
Â  Â  Â  window.mockDb.data = newFullData;
Â  Â  Â  window.mockDb.notify();

Â  Â  Â  showToast(`âœ… ImportaciÃ³n completada con Ã©xito`);
Â  Â  Â  showModal = null;
Â  Â  Â  selectedOrder = null;
Â  Â  Â  render();
Â  Â  }

Â  Â  // Auth Functions
Â  Â  async function handleLogin(e) {
Â  Â  Â  e.preventDefault();
Â  Â  Â  const username = document.getElementById('loginUsername').value.trim();
Â  Â  Â  const password = document.getElementById('loginPassword').value;

Â  Â  Â  if (username === ADMIN_CREDENTIALS.username && password === ADMIN_CREDENTIALS.password) {
Â  Â  Â  Â  currentUser = { username, role: 'admin', __backendId: 'admin' };
Â  Â  Â  Â  showModal = null;
Â  Â  Â  Â  currentView = 'admin';
Â  Â  Â  Â  showToast('Bienvenido Admin');
Â  Â  Â  Â  await updateUserActivity();
Â  Â  Â  Â  render();
Â  Â  Â  Â  return;
Â  Â  Â  }

Â  Â  Â  const user = allUsers.find(u => u.username === username && u.password === password);
Â  Â  Â  if (user) {
Â  Â  Â  Â  // VERIFICAR SI ESTÃ BANEADO
Â  Â  Â  Â  if (user.status === 'banned') {
Â  Â  Â  Â  Â  Â  showToast('ğŸš« Tu cuenta ha sido suspendida/baneada.');
Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  }

Â  Â  Â  Â  if (user.role === 'reseller' && !user.approved) {
Â  Â  Â  Â  Â  showToast('Tu cuenta aÃºn no ha sido aprobada');
Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  }
Â  Â  Â  Â  
Â  Â  Â  Â  currentUser = {Â 
Â  Â  Â  Â  Â  username: user.username,
Â  Â  Â  Â  Â  role: user.role,
Â  Â  Â  Â  Â  shop_name: user.shop_name,
Â  Â  Â  Â  Â  discord_tag: user.discord_tag,
Â  Â  Â  Â  Â  __backendId: user.__backendId
Â  Â  Â  Â  };
Â  Â  Â  Â  
Â  Â  Â  Â  if (user.role === 'reseller' && (!user.shop_name || !user.discord_tag)) {
Â  Â  Â  Â  Â  selectedOrder = user;
Â  Â  Â  Â  Â  showModal = 'setupShop';
Â  Â  Â  Â  Â  showToast('Por favor configura tu tienda para continuar');
Â  Â  Â  Â  Â  render();
Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  }
Â  Â  Â  Â  
Â  Â  Â  Â  showModal = null;
Â  Â  Â  Â  if (user.role === 'reseller' || user.role === 'admin') {
Â  Â  Â  Â  Â  currentView = 'admin';
Â  Â  Â  Â  }
Â  Â  Â  Â  showToast(`Bienvenido ${username}`);
Â  Â  Â  Â  
Â  Â  Â  Â  await updateUserActivity();
Â  Â  Â  Â  checkPendingReviews();
Â  Â  Â  Â  render();
Â  Â  Â  } else {
Â  Â  Â  Â  showToast('Usuario o contraseÃ±a incorrectos');
Â  Â  Â  }
Â  Â  }

Â  Â  async function handleRegisterBuyer(e) {
Â  Â  Â  e.preventDefault();
Â  Â  Â  const username = document.getElementById('buyerUsername').value.trim();
Â  Â  Â  const password = document.getElementById('buyerPassword').value;
Â  Â  Â  const discord = document.getElementById('buyerDiscord').value.trim();

Â  Â  Â  if (allUsers.find(u => u.username === username)) {
Â  Â  Â  Â  showToast('El usuario ya existe');
Â  Â  Â  Â  return;
Â  Â  Â  }

Â  Â  Â  const userData = {
Â  Â  Â  Â  id: Date.now().toString(),
Â  Â  Â  Â  type: 'user',
Â  Â  Â  Â  username,
Â  Â  Â  Â  password,
Â  Â  Â  Â  discord_tag: discord,
Â  Â  Â  Â  profile_picture: '',
Â  Â  Â  Â  role: 'buyer',
Â  Â  Â  Â  approved: true,
Â  Â  Â  Â  status: 'active',
Â  Â  Â  Â  created_at: new Date().toISOString()
Â  Â  Â  };

Â  Â  Â  const result = await window.dataSdk.create(userData);
Â  Â  Â  if (result.isOk) {
Â  Â  Â  Â  showToast('Registro exitoso! Ahora puedes iniciar sesiÃ³n');
Â  Â  Â  Â  showModal = 'login';
Â  Â  Â  Â  render();
Â  Â  Â  } else {
Â  Â  Â  Â  showToast('Error al registrar usuario');
Â  Â  Â  }
Â  Â  }

Â  Â  async function handleRegisterReseller(e) {
Â  Â  Â  e.preventDefault();
Â  Â  Â  const username = document.getElementById('resellerUsername').value.trim();
Â  Â  Â  const password = document.getElementById('resellerPassword').value;
Â  Â  Â  const discord = document.getElementById('resellerDiscord').value.trim();
Â  Â  Â  const shopName = document.getElementById('resellerShop').value.trim();

Â  Â  Â  if (allUsers.find(u => u.username === username)) {
Â  Â  Â  Â  showToast('El usuario ya existe');
Â  Â  Â  Â  return;
Â  Â  Â  }

Â  Â  Â  const userData = {
Â  Â  Â  Â  id: Date.now().toString(),
Â  Â  Â  Â  type: 'user',
Â  Â  Â  Â  username,
Â  Â  Â  Â  password,
Â  Â  Â  Â  discord_tag: discord,
Â  Â  Â  Â  shop_name: shopName,
Â  Â  Â  Â  profile_picture: '',
Â  Â  Â  Â  role: 'reseller',
Â  Â  Â  Â  approved: false,
Â  Â  Â  Â  status: 'pending',
Â  Â  Â  Â  created_at: new Date().toISOString()
Â  Â  Â  };

Â  Â  Â  const result = await window.dataSdk.create(userData);
Â  Â  Â  if (result.isOk) {
Â  Â  Â  Â  showToast('Solicitud enviada! Espera aprobaciÃ³n del admin');
Â  Â  Â  Â  showModal = null;
Â  Â  Â  Â  render();
Â  Â  Â  } else {
Â  Â  Â  Â  showToast('Error al enviar solicitud');
Â  Â  Â  }
Â  Â  }

Â  Â  async function updateUserActivity() {
Â  Â  Â  if (!currentUser) return;
Â  Â  Â  
Â  Â  Â  const activityRecords = window.mockDb.data.filter(item => item.type === 'activity');
Â  Â  Â  const existingActivity = activityRecords.find(a => a.username === currentUser.username);
Â  Â  Â  
Â  Â  Â  if (existingActivity) {
Â  Â  Â  Â  existingActivity.last_activity = new Date().toISOString();
Â  Â  Â  Â  await window.dataSdk.update(existingActivity);
Â  Â  Â  } else {
Â  Â  Â  Â  const activityData = {
Â  Â  Â  Â  Â  id: 'activity_' + currentUser.username,
Â  Â  Â  Â  Â  type: 'activity',
Â  Â  Â  Â  Â  username: currentUser.username,
Â  Â  Â  Â  Â  last_activity: new Date().toISOString()
Â  Â  Â  Â  };
Â  Â  Â  Â  await window.dataSdk.create(activityData);
Â  Â  Â  }
Â  Â  Â  
Â  Â  Â  if (userActivityTimeout) clearTimeout(userActivityTimeout);
Â  Â  Â  userActivityTimeout = setTimeout(updateUserActivity, 2 * 60 * 1000);
Â  Â  }

Â  Â  function logout() {
Â  Â  Â  if (userActivityTimeout) clearTimeout(userActivityTimeout);
Â  Â  Â  currentUser = null;
Â  Â  Â  currentView = 'catalog';
Â  Â  Â  cart = [];
Â  Â  Â  localStorage.removeItem('mu_cart_v2'); // Limpiar carrito en localStorage al salir
Â  Â  Â  showToast('SesiÃ³n cerrada');
Â  Â  Â  render();
Â  Â  }

Â  Â  // Product Functions
Â  Â  async function handleAddProduct(e) {
Â  Â  Â  e.preventDefault();
Â  Â  Â  if (allProducts.length >= 999) {
Â  Â  Â  Â  showToast('LÃ­mite de productos alcanzado');
Â  Â  Â  Â  return;
Â  Â  Â  }

Â  Â  Â  const btn = e.target.querySelector('button[type="submit"]');
Â  Â  Â  btn.disabled = true;
Â  Â  Â  btn.innerHTML = '<div class="loading-spinner mx-auto"></div>';

Â  Â  Â  let imageUrl = document.getElementById('productImage').value.trim();
Â  Â  Â  
Â  Â  Â  if (imageUrl && imageUrl.includes('imgur.com/') && !imageUrl.match(/\.(jpg|jpeg|png|gif|webp)$/i)) {
Â  Â  Â  Â  imageUrl = imageUrl + '.jpg';
Â  Â  Â  }

Â  Â  Â  const discount = parseInt(document.getElementById('productDiscount').value) || 0;
Â  Â  Â  const onSale = document.getElementById('productOnSale').checked;
Â  Â  Â  const originalPrice = parseFloat(document.getElementById('productPrice').value);
Â  Â  Â  const finalPrice = discount > 0 ? originalPrice * (1 - discount / 100) : originalPrice;
Â  Â  Â  
Â  Â  Â  const userData = getCurrentUserData();

Â  Â  Â  const productData = {
Â  Â  Â  Â  id: Date.now().toString(),
Â  Â  Â  Â  type: 'product',
Â  Â  Â  Â  name: document.getElementById('productName').value.trim(),
Â  Â  Â  Â  category: document.getElementById('productCategory').value,
Â  Â  Â  Â  price: originalPrice,
Â  Â  Â  Â  final_price: finalPrice,
Â  Â  Â  Â  discount: discount,
Â  Â  Â  Â  on_sale: onSale,
Â  Â  Â  Â  stock: parseInt(document.getElementById('productStock').value),
Â  Â  Â  Â  description: document.getElementById('productDescription').value.trim(),
Â  Â  Â  Â  image_url: imageUrl,
Â  Â  Â  Â  seller_username: currentUser.username,
Â  Â  Â  Â  seller_shop_name: userData.shop_name || currentUser.username,
Â  Â  Â  Â  seller_discord: userData.discord_tag || 'Admin',
Â  Â  Â  Â  created_at: new Date().toISOString()
Â  Â  Â  };

Â  Â  Â  const result = await window.dataSdk.create(productData);
Â  Â  Â  if (result.isOk) {
Â  Â  Â  Â  showToast('Producto agregado exitosamente');
Â  Â  Â  Â  e.target.reset();
Â  Â  Â  } else {
Â  Â  Â  Â  showToast('Error al agregar producto');
Â  Â  Â  }

Â  Â  Â  btn.disabled = false;
Â  Â  Â  btn.innerHTML = 'Agregar Producto';
Â  Â  }

Â  Â  async function deleteProduct(backendId) {
Â  Â  Â  const product = allProducts.find(p => p.__backendId === backendId);
Â  Â  Â  if (!product) return;

Â  Â  Â  const result = await window.dataSdk.delete(product);
Â  Â  Â  if (result.isOk) {
Â  Â  Â  Â  showToast('Producto eliminado');
Â  Â  Â  } else {
Â  Â  Â  Â  showToast('Error al eliminar producto');
Â  Â  Â  }
Â  Â  }

Â  Â  // LOGICA DE APROBACIÃ“N / RECHAZO (Borrado)
Â  Â  async function approveReseller(backendId, approve) {
Â  Â  Â  const user = allUsers.find(u => u.__backendId === backendId);
Â  Â  Â  if (!user) return;

Â  Â  Â  if (approve) {
Â  Â  Â  Â  user.approved = true;
Â  Â  Â  Â  user.status = 'approved';
Â  Â  Â  Â  const result = await window.dataSdk.update(user);
Â  Â  Â  Â  if (result.isOk) showToast('Vendedor aprobado');
Â  Â  Â  } else {
Â  Â  Â  Â  // SI ES RECHAZADO, SE BORRA LA SOLICITUD
Â  Â  Â  Â  const result = await window.dataSdk.delete(user);
Â  Â  Â  Â  if (result.isOk) showToast('Solicitud rechazada y eliminada de la base de datos');
Â  Â  Â  }
Â  Â  }

Â  Â  async function changeUserRole(backendId, newRole) {
Â  Â  Â  const user = allUsers.find(u => u.__backendId === backendId);
Â  Â  Â  if (!user) return;

Â  Â  Â  const oldRole = user.role;
Â  Â  Â  user.role = newRole;
Â  Â  Â  
Â  Â  Â  if (newRole === 'reseller') {
Â  Â  Â  Â  user.approved = true;
Â  Â  Â  Â  user.status = 'approved';
Â  Â  Â  } else if (newRole === 'admin') {
Â  Â  Â  Â  user.approved = true;
Â  Â  Â  Â  user.status = 'approved';
Â  Â  Â  Â  if (oldRole === 'reseller') {
Â  Â  Â  Â  Â  user.shop_name = '';
Â  Â  Â  Â  Â  user.discord_tag = user.discord_tag || '';
Â  Â  Â  Â  }
Â  Â  Â  } else if (newRole === 'buyer') {
Â  Â  Â  Â  user.approved = true;
Â  Â  Â  Â  user.status = 'active';
Â  Â  Â  Â  user.shop_name = '';
Â  Â  Â  }

Â  Â  Â  const result = await window.dataSdk.update(user);
Â  Â  Â  if (result.isOk) {
Â  Â  Â  Â  showToast(`Rol cambiado a ${newRole}`);
Â  Â  Â  } else {
Â  Â  Â  Â  showToast('Error al cambiar rol');
Â  Â  Â  }
Â  Â  }

Â  Â  // NUEVAS FUNCIONES: BANEO Y ELIMINAR CUENTA
Â  Â  async function banUser(backendId) {
Â  Â  Â  Â  const user = allUsers.find(u => u.__backendId === backendId);
Â  Â  Â  Â  if (!user) return;

Â  Â  Â  Â  if(user.status === 'banned') {
Â  Â  Â  Â  Â  Â  // Unban logic if needed, or just inform
Â  Â  Â  Â  Â  Â  user.status = 'active';
Â  Â  Â  Â  Â  Â  user.approved = true;
Â  Â  Â  Â  Â  Â  await window.dataSdk.update(user);
Â  Â  Â  Â  Â  Â  showToast('Usuario desbaneado (activo)');
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  user.status = 'banned';
Â  Â  Â  Â  Â  Â  user.approved = false;
Â  Â  Â  Â  Â  Â  await window.dataSdk.update(user);
Â  Â  Â  Â  Â  Â  showToast('ğŸš« Usuario BANEADO exitosamente');
Â  Â  Â  Â  }
Â  Â  }

Â  Â  async function deleteUserAccount(backendId) {
Â  Â  Â  Â  if(!confirm("âš ï¸ Â¿EstÃ¡s seguro de ELIMINAR DEFINITIVAMENTE esta cuenta y todos sus datos?")) return;
Â  Â  Â  Â  
Â  Â  Â  Â  const user = allUsers.find(u => u.__backendId === backendId);
Â  Â  Â  Â  if (!user) return;

Â  Â  Â  Â  // Opcional: Borrar productos asociados si es vendedor
Â  Â  Â  Â  if(user.role === 'reseller') {
Â  Â  Â  Â  Â  Â  const userProducts = allProducts.filter(p => p.seller_username === user.username);
Â  Â  Â  Â  Â  Â  for(const p of userProducts) {
Â  Â  Â  Â  Â  Â  Â  Â  await window.dataSdk.delete(p);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  const result = await window.dataSdk.delete(user);
Â  Â  Â  Â  if (result.isOk) {
Â  Â  Â  Â  Â  Â  showToast('ğŸ—‘ï¸ Cuenta eliminada correctamente');
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  showToast('Error al eliminar cuenta');
Â  Â  Â  Â  }
Â  Â  }

Â  Â  async function handleSetupShop(e) {
Â  Â  Â  e.preventDefault();
Â  Â  Â  const user = selectedOrder;
Â  Â  Â  if (!user) return;

Â  Â  Â  const btn = e.target.querySelector('button[type="submit"]');
Â  Â  Â  btn.disabled = true;
Â  Â  Â  btn.innerHTML = '<div class="loading-spinner mx-auto"></div>';

Â  Â  Â  const shopName = document.getElementById('setupShopName').value.trim();
Â  Â  Â  const discordTag = document.getElementById('setupDiscord').value.trim();

Â  Â  Â  // Validar Discord (simple)
Â  Â  Â  const discordExists = allUsers.find(u => u.discord_tag === discordTag && u.__backendId !== user.__backendId);
Â  Â  Â  if (discordExists) {
Â  Â  Â  Â  showToast('Este Discord ya estÃ¡ registrado por otro usuario');
Â  Â  Â  Â  btn.disabled = false;
Â  Â  Â  Â  btn.innerHTML = 'Crear Tienda';
Â  Â  Â  Â  return;
Â  Â  Â  }

Â  Â  Â  user.role = 'reseller';
Â  Â  Â  user.shop_name = shopName;
Â  Â  Â  user.discord_tag = discordTag;
Â  Â  Â  user.approved = true;
Â  Â  Â  user.status = 'approved';

Â  Â  Â  const result = await window.dataSdk.update(user);
Â  Â  Â  if (result.isOk) {
Â  Â  Â  Â  showToast('Tienda configurada exitosamente');
Â  Â  Â  Â  showModal = null;
Â  Â  Â  Â  selectedOrder = null;
Â  Â  Â  Â  
Â  Â  Â  Â  if (currentUser && user.__backendId === currentUser.__backendId) {
Â  Â  Â  Â  Â  currentUser = user;
Â  Â  Â  Â  Â  currentView = 'admin';
Â  Â  Â  Â  }
Â  Â  Â  Â  
Â  Â  Â  Â  render();
Â  Â  Â  } else {
Â  Â  Â  Â  showToast('Error al configurar tienda');
Â  Â  Â  Â  btn.disabled = false;
Â  Â  Â  Â  btn.innerHTML = 'Crear Tienda';
Â  Â  Â  }
Â  Â  }

Â  Â  // User Profile & Search Functions
Â  Â  function filterUsers(searchTerm) {
Â  Â  Â  const rows = document.querySelectorAll('.user-row');
Â  Â  Â  const term = searchTerm.toLowerCase().trim();
Â  Â  Â  
Â  Â  Â  rows.forEach(row => {
Â  Â  Â  Â  const username = row.getAttribute('data-username');
Â  Â  Â  Â  if (username.includes(term)) {
Â  Â  Â  Â  Â  row.style.display = '';
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  row.style.display = 'none';
Â  Â  Â  Â  }
Â  Â  Â  });
Â  Â  }

Â  Â  function viewUserProfile(backendId) {
Â  Â  Â  const user = allUsers.find(u => u.__backendId === backendId);
Â  Â  Â  if (!user) return;
Â  Â  Â  
Â  Â  Â  selectedOrder = user;
Â  Â  Â  showModal = 'userProfile';
Â  Â  Â  render();
Â  Â  }

Â  Â  // Cart Functions
Â  Â  function updateCartStorage() {
Â  Â  Â  localStorage.setItem('mu_cart_v2', JSON.stringify(cart));
Â  Â  }

Â  Â  function addToCart(backendId) {
Â  Â  Â  if (!currentUser) {
Â  Â  Â  Â  showToast('Inicia sesiÃ³n para agregar al carrito');
Â  Â  Â  Â  showModal = 'login';
Â  Â  Â  Â  render();
Â  Â  Â  Â  return;
Â  Â  Â  }

Â  Â  Â  const product = allProducts.find(p => p.__backendId === backendId);
Â  Â  Â  if (!product || product.stock <= 0) {
Â  Â  Â  Â  showToast('Producto sin stock');
Â  Â  Â  Â  return;
Â  Â  Â  }

Â  Â  Â  const existing = cart.find(item => item.__backendId === backendId);
Â  Â  Â  if (existing) {
Â  Â  Â  Â  if (existing.quantity < product.stock) {
Â  Â  Â  Â  Â  existing.quantity++;
Â  Â  Â  Â  Â  showToast('Cantidad actualizada');
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  showToast('No hay mÃ¡s stock disponible');
Â  Â  Â  Â  }
Â  Â  Â  } else {
Â  Â  Â  Â  cart.push({ ...product, quantity: 1 });
Â  Â  Â  Â  showToast('Agregado al carrito');
Â  Â  Â  }
Â  Â  Â  updateCartStorage();
Â  Â  Â  render();
Â  Â  }

Â  Â  function updateCartQuantity(index, change) {
Â  Â  Â  const item = cart[index];
Â  Â  Â  const product = allProducts.find(p => p.__backendId === item.__backendId);
Â  Â  Â  const newQuantity = item.quantity + change;

Â  Â  Â  if (newQuantity < 1) {
Â  Â  Â  Â  removeFromCart(index);
Â  Â  Â  Â  return;
Â  Â  Â  }

Â  Â  Â  if (newQuantity <= product.stock) {
Â  Â  Â  Â  cart[index].quantity = newQuantity;
Â  Â  Â  Â  updateCartStorage();
Â  Â  Â  Â  render();
Â  Â  Â  } else {
Â  Â  Â  Â  showToast('No hay mÃ¡s stock disponible');
Â  Â  Â  }
Â  Â  }

Â  Â  function removeFromCart(index) {
Â  Â  Â  cart.splice(index, 1);
Â  Â  Â  updateCartStorage();
Â  Â  Â  showToast('Producto eliminado del carrito');
Â  Â  Â  render();
Â  Â  }

Â  Â  function clearCart() {
Â  Â  Â  cart = [];
Â  Â  Â  updateCartStorage();
Â  Â  Â  render();
Â  Â  }

Â  Â  // Order Functions
Â  Â  async function createOrder() {
Â  Â  Â  if (cart.length === 0) return;
Â  Â  Â  if (allOrders.length >= 999) {
Â  Â  Â  Â  showToast('LÃ­mite de pedidos alcanzado');
Â  Â  Â  Â  return;
Â  Â  Â  }

Â  Â  Â  const ordersBySeller = {};
Â  Â  Â  cart.forEach(item => {
Â  Â  Â  Â  if (!ordersBySeller[item.seller_username]) {
Â  Â  Â  Â  Â  ordersBySeller[item.seller_username] = {
Â  Â  Â  Â  Â  Â  seller: item.seller_username,
Â  Â  Â  Â  Â  Â  discord: item.seller_discord,
Â  Â  Â  Â  Â  Â  items: [],
Â  Â  Â  Â  Â  Â  total: 0
Â  Â  Â  Â  Â  };
Â  Â  Â  Â  }
Â  Â  Â  Â  const itemPrice = item.discount > 0 ? item.final_price : item.price;
Â  Â  Â  Â  ordersBySeller[item.seller_username].items.push(item);
Â  Â  Â  Â  ordersBySeller[item.seller_username].total += itemPrice * item.quantity;
Â  Â  Â  });

Â  Â  Â  for (const sellerUsername in ordersBySeller) {
Â  Â  Â  Â  const orderInfo = ordersBySeller[sellerUsername];
Â  Â  Â  Â  const itemsDesc = orderInfo.items.map(item => {
Â  Â  Â  Â  Â  const itemPrice = item.discount > 0 ? item.final_price : item.price;
Â  Â  Â  Â  Â  return `${item.name} x${item.quantity} ($${(itemPrice * item.quantity).toFixed(2)} USDT)`;
Â  Â  Â  Â  }).join(' | ');

Â  Â  Â  Â  const itemsData = JSON.stringify(orderInfo.items.map(item => ({
Â  Â  Â  Â  Â  backendId: item.__backendId,
Â  Â  Â  Â  Â  name: item.name,
Â  Â  Â  Â  Â  quantity: item.quantity
Â  Â  Â  Â  })));

Â  Â  Â  Â  const orderData = {
Â  Â  Â  Â  Â  id: Date.now().toString() + '_' + sellerUsername,
Â  Â  Â  Â  Â  type: 'order',
Â  Â  Â  Â  Â  buyer_username: currentUser.username,
Â  Â  Â  Â  Â  buyer_discord: currentUser.discord_tag,
Â  Â  Â  Â  Â  seller_username: sellerUsername,
Â  Â  Â  Â  Â  seller_discord: orderInfo.discord,
Â  Â  Â  Â  Â  items: itemsDesc,
Â  Â  Â  Â  Â  items_data: itemsData,
Â  Â  Â  Â  Â  total: orderInfo.total,
Â  Â  Â  Â  Â  order_status: 'pending',
Â  Â  Â  Â  Â  seller_confirmed: false,
Â  Â  Â  Â  Â  buyer_confirmed: false,
Â  Â  Â  Â  Â  created_at: new Date().toISOString()
Â  Â  Â  Â  };

Â  Â  Â  Â  const result = await window.dataSdk.create(orderData);
Â  Â  Â  Â  if (!result.isOk) {
Â  Â  Â  Â  Â  showToast('Error al crear pedido');
Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  }
Â  Â  Â  }

Â  Â  Â  showToast('Pedido(s) creado(s) exitosamente! Contacta al vendedor por Discord');
Â  Â  Â  cart = [];
Â  Â  Â  updateCartStorage();
Â  Â  Â  currentView = 'orders';
Â  Â  Â  render();
Â  Â  }

Â  Â  async function confirmOrder(backendId, isSeller) {
Â  Â  Â  const order = allOrders.find(o => o.__backendId === backendId);
Â  Â  Â  if (!order) return;

Â  Â  Â  if (isSeller) {
Â  Â  Â  Â  order.seller_confirmed = true;
Â  Â  Â  } else {
Â  Â  Â  Â  order.buyer_confirmed = true;
Â  Â  Â  }

Â  Â  Â  if (order.seller_confirmed && order.buyer_confirmed && order.order_status !== 'completed') {
Â  Â  Â  Â  order.order_status = 'completed';
Â  Â  Â  Â  order.needs_review = true;
Â  Â  Â  Â  
Â  Â  Â  Â  // Actualizar Stock
Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  const itemsData = JSON.parse(order.items_data);
Â  Â  Â  Â  Â  for (const item of itemsData) {
Â  Â  Â  Â  Â  Â  const product = allProducts.find(p => p.__backendId === item.backendId);
Â  Â  Â  Â  Â  Â  if (product) {
Â  Â  Â  Â  Â  Â  Â  // Usamos el Ã­ndice de la data global para asegurar que se actualiza el mockDb
Â  Â  Â  Â  Â  Â  Â  const index = window.mockDb.data.findIndex(i => i.__backendId === product.__backendId);
Â  Â  Â  Â  Â  Â  Â  if (index !== -1) {
Â  Â  Â  Â  Â  Â  Â  Â  const updatedProduct = {...product, stock: Math.max(0, product.stock - item.quantity)};
Â  Â  Â  Â  Â  Â  Â  Â  await window.dataSdk.update(updatedProduct);
Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  }
Â  Â  Â  Â  } catch (e) {
Â  Â  Â  Â  Â  console.error('Error procesando items:', e);
Â  Â  Â  Â  }
Â  Â  Â  }

Â  Â  Â  const result = await window.dataSdk.update(order);
Â  Â  Â  
Â  Â  Â  if (result.isOk) {
Â  Â  Â  Â  if (order.order_status === 'completed') {
Â  Â  Â  Â  Â  showToast('Â¡Pedido completado! Stock actualizado');
Â  Â  Â  Â  Â  if (!isSeller) {
Â  Â  Â  Â  Â  Â  selectedOrder = order;
Â  Â  Â  Â  Â  Â  showModal = 'review';
Â  Â  Â  Â  Â  Â  isReviewModalOpen = true; // Establecer bandera
Â  Â  Â  Â  Â  Â  render();
Â  Â  Â  Â  Â  }
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  showToast('ConfirmaciÃ³n registrada. Esperando confirmaciÃ³n de ' + (isSeller ? 'comprador' : 'vendedor'));
Â  Â  Â  Â  }
Â  Â  Â  Â  render();
Â  Â  Â  } else {
Â  Â  Â  Â  showToast('Error al confirmar pedido');
Â  Â  Â  }
Â  Â  }

Â  Â  async function handleSubmitReview(e) {
Â  Â  Â  e.preventDefault();
Â  Â  Â  if (!selectedOrder) return;

Â  Â  Â  // Corregido: Obtener la calificaciÃ³n de los radios ocultos.
Â  Â  Â  const ratingInput = document.querySelector('.star-rating input:checked');
Â  Â  Â  const rating = parseInt(ratingInput?.value || '0');
Â  Â  Â  const reviewText = document.getElementById('reviewText').value.trim();

Â  Â  Â  if (rating === 0) {
Â  Â  Â  Â  showToast('Por favor selecciona una calificaciÃ³n');
Â  Â  Â  Â  return;
Â  Â  Â  }

Â  Â  Â  const btn = e.target.querySelector('button[type="submit"]');
Â  Â  Â  btn.disabled = true;
Â  Â  Â  btn.innerHTML = '<div class="loading-spinner mx-auto"></div>';

Â  Â  Â  const reviewData = {
Â  Â  Â  Â  id: Date.now().toString(),
Â  Â  Â  Â  type: 'review',
Â  Â  Â  Â  buyer_username: currentUser.username,
Â  Â  Â  Â  reviewed_seller: selectedOrder.seller_username,
Â  Â  Â  Â  rating: rating,
Â  Â  Â  Â  review_text: reviewText,
Â  Â  Â  Â  created_at: new Date().toISOString()
Â  Â  Â  };

Â  Â  Â  const reviewResult = await window.dataSdk.create(reviewData);
Â  Â  Â  
Â  Â  Â  if (reviewResult.isOk) {
Â  Â  Â  Â  // Marcar orden como revisada
Â  Â  Â  Â  selectedOrder.needs_review = false;
Â  Â  Â  Â  await window.dataSdk.update(selectedOrder);
Â  Â  Â  Â  
Â  Â  Â  Â  showToast('Â¡Gracias por tu reseÃ±a!');
Â  Â  Â  Â  showModal = null;
Â  Â  Â  Â  selectedOrder = null;
Â  Â  Â  Â  isReviewModalOpen = false; // Restablecer bandera
Â  Â  Â  Â  render();
Â  Â  Â  } else {
Â  Â  Â  Â  showToast('Error al guardar reseÃ±a');
Â  Â  Â  }

Â  Â  Â  btn.disabled = false;
Â  Â  Â  btn.innerHTML = 'Enviar ReseÃ±a';
Â  Â  }

Â  Â  // Review Functions
Â  Â  // CORREGIDO: Devuelve 0.0 y 0 si no hay reseÃ±as para que el Top funcione.
Â  Â  function getSellerRating(sellerUsername) {
Â  Â  Â  const sellerReviews = allReviews.filter(r => r.reviewed_seller === sellerUsername);
Â  Â  Â  if (sellerReviews.length === 0) return { average: 0.0, count: 0 };
Â  Â  Â  
Â  Â  Â  const sum = sellerReviews.reduce((acc, r) => acc + r.rating, 0);
Â  Â  Â  return {
Â  Â  Â  Â  average: (sum / sellerReviews.length).toFixed(1),
Â  Â  Â  Â  count: sellerReviews.length
Â  Â  Â  };
Â  Â  }

Â  Â  // CORREGIDO: Quitado el filtro que eliminaba las tiendas con 0 reseÃ±as
Â  Â  function getTopShops() {
Â  Â  Â  const resellers = allUsers.filter(u => u.role === 'reseller' && u.approved);
Â  Â  Â  const shopsWithRatings = resellers.map(seller => {
Â  Â  Â  Â  const rating = getSellerRating(seller.username);
Â  Â  Â  Â  return {
Â  Â  Â  Â  Â  ...seller,
Â  Â  Â  Â  Â  rating: parseFloat(rating.average),
Â  Â  Â  Â  Â  reviewCount: rating.count
Â  Â  Â  Â  };
Â  Â  Â  }); /* .filter(shop => shop.reviewCount > 0); */ // <-- FILTRO ELIMINADO

Â  Â  Â  return shopsWithRatings.sort((a, b) => {
Â  Â  Â  Â  if (b.rating !== a.rating) return b.rating - a.rating;
Â  Â  Â  Â  return b.reviewCount - a.reviewCount;
Â  Â  Â  }).slice(0, 3);
Â  Â  }

Â  Â  // MEJORADO: Renderizado de estrellas (usa Math.round para simplificar)
Â  Â  function renderStars(rating) {
Â  Â  Â  const roundedRating = Math.round(rating);
Â  Â  Â  let stars = '';
Â  Â  Â  for (let i = 0; i < roundedRating; i++) stars += 'â­';
Â  Â  Â  const emptyStars = 5 - roundedRating;
Â  Â  Â  for (let i = 0; i < emptyStars; i++) stars += 'â˜†';
Â  Â  Â  return stars;
Â  Â  }

Â  Â  // Utility Functions
Â  Â  function showToast(message) {
Â  Â  Â  const toast = document.createElement('div');
Â  Â  Â  toast.className = 'fixed bottom-6 right-6 px-6 py-3 rounded-lg shadow-lg font-semibold z-50 text-white';
Â  Â  Â  toast.style.backgroundColor = getConfig().primary_button;
Â  Â  Â  toast.textContent = message;
Â  Â  Â  document.body.appendChild(toast);
Â  Â  Â  setTimeout(() => toast.remove(), 3000);
Â  Â  }

Â  Â  function getConfig() {
Â  Â  Â  return window.elementSdk ? window.elementSdk.config : defaultConfig;
Â  Â  }

Â  Â  function getCurrentUserData() {
Â  Â  Â  if (!currentUser) return null;
Â  Â  Â  if (currentUser.role === 'admin' && currentUser.__backendId === 'admin') {
Â  Â  Â  Â  return currentUser;
Â  Â  Â  }
Â  Â  Â  return allUsers.find(u => u.username === currentUser.username);
Â  Â  }

Â  Â  function getCategoryIcon(categoryId) {
Â  Â  Â  const cat = CATEGORIES.find(c => c.id === categoryId);
Â  Â  Â  return cat ? cat.icon : 'ğŸ“¦';
Â  Â  }

Â  Â  function getCategoryName(categoryId) {
Â  Â  Â  const cat = CATEGORIES.find(c => c.id === categoryId);
Â  Â  Â  return cat ? cat.name : 'Otro';
Â  Â  }

Â  Â  // Render Functions
Â  Â  function render() {
Â  Â  Â  const app = document.getElementById('app');
Â  Â  Â  const config = getConfig();

Â  Â  Â  document.body.style.backgroundColor = config.background_color;
Â  Â  Â  document.body.style.color = config.text_color;
Â  Â  Â  document.body.style.fontFamily = `${config.font_family}, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif`;

Â  Â  Â  try {
Â  Â  Â  Â  if (currentView === 'catalog') {
Â  Â  Â  Â  Â  app.innerHTML = renderCatalog();
Â  Â  Â  Â  } else if (currentView === 'cart') {
Â  Â  Â  Â  Â  app.innerHTML = renderCart();
Â  Â  Â  Â  } else if (currentView === 'orders') {
Â  Â  Â  Â  Â  app.innerHTML = renderOrders();
Â  Â  Â  Â  } else if (currentView === 'admin') {
Â  Â  Â  Â  Â  app.innerHTML = renderAdmin();
Â  Â  Â  Â  }
Â  Â  Â  } catch (error) {
Â  Â  Â  Â  console.error("Error en la funciÃ³n render:", error);
Â  Â  Â  Â  app.innerHTML = `<div class="text-center p-20 text-red-500" style="background-color: ${config.background_color}; color: ${config.text_color};">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h1 class="text-2xl font-bold">âŒ Error en el Renderizado de la Vista</h1>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="mt-4">La vista fallÃ³ al dibujarse. El error es: ${error.message}</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>`;
Â  Â  Â  Â  return; // Detener la ejecuciÃ³n del render de modal si la vista principal fallÃ³
Â  Â  Â  }
Â  Â  Â  
Â  Â  Â  // Asegurar que el modal se renderice en el DOM
Â  Â  Â  let modalContainer = document.getElementById('modalContainer');
Â  Â  Â  if (!modalContainer) {
Â  Â  Â  Â  modalContainer = document.createElement('div');
Â  Â  Â  Â  modalContainer.id = 'modalContainer';
Â  Â  Â  Â  document.body.appendChild(modalContainer);
Â  Â  Â  }

Â  Â  Â  if (showModal) {
Â  Â  Â  Â  modalContainer.innerHTML = renderModal();
Â  Â  Â  } else {
Â  Â  Â  Â  modalContainer.innerHTML = '';
Â  Â  Â  Â  isReviewModalOpen = false; // Asegurar que la bandera se desactive al cerrar el modal
Â  Â  Â  }
Â  Â  }

Â  Â  function renderCatalog() {
Â  Â  Â  const config = getConfig();
Â  Â  Â  const filteredProducts = selectedCategory === 'all'Â 
Â  Â  Â  Â  ? allProductsÂ 
Â  Â  Â  Â  : selectedCategory === 'promotions'
Â  Â  Â  Â  ? allProducts.filter(p => p.on_sale === true)
Â  Â  Â  Â  : allProducts.filter(p => p.category === selectedCategory);

Â  Â  Â  const cartCount = cart.reduce((sum, item) => sum + item.quantity, 0);
Â  Â  Â  const topShops = getTopShops();

Â  Â  Â  return `
Â  Â  Â  Â  <div class="min-h-full" style="background-color: ${config.background_color}; color: ${config.text_color};">
Â  Â  Â  Â  Â  <header class="shadow-lg" style="background-color: ${config.card_background};">
Â  Â  Â  Â  Â  Â  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
Â  Â  Â  Â  Â  Â  Â  <div class="flex flex-col lg:flex-row justify-between items-center gap-4">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="text-center lg:text-left">
Â  Â  Â  Â  Â  Â  Â  Â  Â  <h1 class="text-3xl lg:text-4xl font-bold">${config.site_title}</h1>
Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-sm lg:text-base mt-2 opacity-80">${config.welcome_message}</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-xs mt-1 opacity-60">${config.contact_info}</p>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex flex-wrap gap-2 justify-center">
Â  Â  Â  Â  Â  Â  Â  Â  Â  ${currentUser ? `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="currentView='cart'; render();" class="relative px-4 py-2 rounded-lg font-semibold transition" style="background-color: ${config.primary_button}; color: white;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ğŸ›’ Carrito
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${cartCount > 0 ? `<span class="cart-badge">${cartCount}</span>` : ''}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="currentView='orders'; render();" class="px-4 py-2 rounded-lg font-semibold transition bg-purple-600 text-white">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ğŸ“¦ Mis Pedidos
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${currentUser.role !== 'buyer' ? `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="currentView='admin'; render();" class="px-4 py-2 rounded-lg font-semibold transition" style="background-color: ${config.secondary_button}; color: white;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${currentUser.role === 'admin' ? 'âš™ï¸ Admin' : 'ğŸª Mi Tienda'}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ` : ''}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="logout();" class="px-4 py-2 rounded-lg font-semibold transition bg-red-600 text-white">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ğŸšª Salir
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  ` : `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="showModal='register'; render();" class="px-4 py-2 rounded-lg font-semibold transition" style="background-color: ${config.secondary_button}; color: white;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ğŸ“ Registrarse
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="showModal='registerReseller'; render();" class="px-4 py-2 rounded-lg font-semibold transition" style="background-color: ${config.primary_button}; color: white;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ğŸª Abrir Tienda
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="showModal='login'; render();" class="px-4 py-2 rounded-lg font-semibold transition bg-purple-600 text-white">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ğŸ” Login
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  `}
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  </header>

Â  Â  Â  Â  Â  ${topShops.length > 0 ? `
Â  Â  Â  Â  Â  Â  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
Â  Â  Â  Â  Â  Â  Â  <div class="rounded-xl p-6 shadow-lg" style="background-color: ${config.card_background};">
Â  Â  Â  Â  Â  Â  Â  Â  <h2 class="text-2xl font-bold mb-4 text-center">ğŸ† Top 3 Tiendas MÃ¡s Confiables</h2>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="grid grid-cols-1 md:grid-cols-3 gap-6 max-w-4xl mx-auto">
Â  Â  Â  Â  Â  Â  Â  Â  Â  ${topShops.map((shop, index) => `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="top-shop-card rounded-lg p-4 text-center shadow-md" style="background-color: rgba(0,0,0,0.3); border: 2px solid ${index === 0 ? '#FFD700' : index === 1 ? '#C0C0C0' : index === 2 ? '#CD7F32' : 'rgba(255,255,255,0.1)'};">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="text-3xl mb-2">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${index === 0 ? 'ğŸ¥‡' : index === 1 ? 'ğŸ¥ˆ' : index === 2 ? 'ğŸ¥‰' : 'ğŸ…'}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="font-bold text-lg mb-1">ğŸª ${shop.shop_name}</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-sm opacity-70 mb-2">ğŸ‘¤ ${shop.username}</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="text-xl mb-1">${renderStars(shop.rating)}</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="font-bold text-lg" style="color: ${config.secondary_button};">${shop.rating.toFixed(1)} â­</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-xs opacity-70">(${shop.reviewCount} reseÃ±as)</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  `).join('')}
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  ` : ''}

Â  Â  Â  Â  Â  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
Â  Â  Â  Â  Â  Â  <div class="flex flex-wrap gap-3 justify-center">
Â  Â  Â  Â  Â  Â  Â  ${CATEGORIES.map(cat => `
Â  Â  Â  Â  Â  Â  Â  Â  <buttonÂ 
Â  Â  Â  Â  Â  Â  Â  Â  Â  onclick="selectedCategory='${cat.id}'; render();"Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  class="category-btn px-6 py-3 rounded-lg font-semibold shadow-md ${selectedCategory === cat.id ? 'ring-4 ring-blue-400' : ''}"
Â  Â  Â  Â  Â  Â  Â  Â  Â  style="background-color: ${selectedCategory === cat.id ? config.primary_button : config.card_background}; color: ${config.text_color};">
Â  Â  Â  Â  Â  Â  Â  Â  Â  ${cat.icon} ${cat.name}
Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  `).join('')}
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6 pb-12">
Â  Â  Â  Â  Â  Â  ${filteredProducts.length === 0 ? `
Â  Â  Â  Â  Â  Â  Â  <div class="text-center py-20">
Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-2xl opacity-60">ğŸ“¦ No hay productos disponibles</p>
Â  Â  Â  Â  Â  Â  Â  Â  <p class="mt-4 opacity-40">Pronto habrÃ¡ items increÃ­bles aquÃ­</p>
Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  ` : `
Â  Â  Â  Â  Â  Â  Â  <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
Â  Â  Â  Â  Â  Â  Â  Â  ${filteredProducts.map(product => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  const rating = getSellerRating(product.seller_username);
Â  Â  Â  Â  Â  Â  Â  Â  Â  return `
Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="product-card rounded-xl shadow-lg overflow-hidden ${product.on_sale ? 'ring-4 ring-red-500' : ''} relative" style="background-color: ${config.card_background};">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${product.on_sale ? `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="absolute top-2 right-2 z-10">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="px-3 py-1 rounded-full text-sm font-bold bg-red-600 text-white shadow-lg animate-pulse">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ğŸ”¥ PROMO
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ` : ''}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="px-4 py-2 bg-gradient-to-r from-purple-600 to-blue-600">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-xs font-semibold text-white flex items-center justify-between">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span>ğŸª ${product.seller_shop_name || product.seller_username}</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${rating.count > 0 ? `<span>â­ ${rating.average} (${rating.count})</span>` : ''}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-xs text-white opacity-90">ğŸ‘¤ ${product.seller_username} | ğŸ’¬ ${product.seller_discord}</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex items-center justify-center h-40 text-6xl" style="background-color: rgba(0,0,0,0.2);">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${product.image_url ? `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <img src="${product.image_url}" alt="${product.name}" class="w-full h-full object-cover" onerror="this.style.display='none'; this.parentElement.innerHTML='${getCategoryIcon(product.category)}';">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ` : getCategoryIcon(product.category)}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="p-4">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h3 class="text-xl font-bold mb-2">${product.name}</h3>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-sm opacity-70 mb-3 line-clamp-2">${product.description}</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex items-center gap-2 mb-3">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="px-3 py-1 rounded-full text-xs font-semibold" style="background-color: ${config.primary_button}; color: white;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${getCategoryIcon(product.category)} ${getCategoryName(product.category)}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="px-3 py-1 rounded-full text-xs font-semibold ${product.stock > 0 ? 'bg-green-600' : 'bg-red-600'} text-white">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ğŸ“¦ Stock: ${product.stock}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex items-center justify-between mt-4">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${product.discount > 0 ? `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-sm line-through opacity-50">$${product.price.toFixed(2)} USDT</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-2xl font-bold" style="color: ${config.secondary_button};">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ğŸ’° $${product.final_price.toFixed(2)} USDT
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="inline-block mt-1 px-2 py-1 rounded-full text-xs font-bold bg-red-600 text-white">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  -${product.discount}% OFF
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ` : `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-2xl font-bold" style="color: ${config.secondary_button};">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ğŸ’° $${product.price.toFixed(2)} USDT
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  `}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <buttonÂ 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  onclick="addToCart('${product.__backendId}')"Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${product.stock <= 0 ? 'disabled' : ''}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  class="px-4 py-2 rounded-lg font-semibold transition disabled:opacity-50 disabled:cursor-not-allowed"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  style="background-color: ${config.secondary_button}; color: white;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${product.stock > 0 ? 'ğŸ›’ Agregar' : 'âŒ Sin Stock'}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  `}).join('')}
Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  `}
Â  Â  Â  Â  Â  </main>
Â  Â  Â  Â  </div>
Â  Â  Â  `;
Â  Â  }

Â  Â  function renderCart() {
Â  Â  Â  const config = getConfig();
Â  Â  Â  const total = cart.reduce((sum, item) => {
Â  Â  Â  Â  const itemPrice = item.discount > 0 ? item.final_price : item.price;
Â  Â  Â  Â  return sum + (itemPrice * item.quantity);
Â  Â  Â  }, 0);

Â  Â  Â  return `
Â  Â  Â  Â  <div class="min-h-full" style="background-color: ${config.background_color}; color: ${config.text_color};">
Â  Â  Â  Â  Â  <header class="shadow-lg" style="background-color: ${config.card_background};">
Â  Â  Â  Â  Â  Â  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
Â  Â  Â  Â  Â  Â  Â  <div class="flex justify-between items-center">
Â  Â  Â  Â  Â  Â  Â  Â  <h1 class="text-3xl font-bold">ğŸ›’ Mi Carrito</h1>
Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="currentView='catalog'; render();" class="px-4 py-2 rounded-lg font-semibold transition" style="background-color: ${config.primary_button}; color: white;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  â† Volver al CatÃ¡logo
Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  </header>

Â  Â  Â  Â  Â  <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
Â  Â  Â  Â  Â  Â  ${cart.length === 0 ? `
Â  Â  Â  Â  Â  Â  Â  <div class="text-center py-20">
Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-4xl mb-4">ğŸ›’</p>
Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-2xl opacity-60 mb-6">Tu carrito estÃ¡ vacÃ­o</p>
Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="currentView='catalog'; render();" class="px-6 py-3 rounded-lg font-semibold transition" style="background-color: ${config.primary_button}; color: white;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Ver Productos
Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  ` : `
Â  Â  Â  Â  Â  Â  Â  <div class="grid lg:grid-cols-3 gap-8">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="lg:col-span-2 space-y-4">
Â  Â  Â  Â  Â  Â  Â  Â  Â  ${cart.map((item, index) => `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="rounded-xl p-4 shadow-lg" style="background-color: ${config.card_background};">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex gap-4">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex-shrink-0 w-24 h-24 rounded-lg flex items-center justify-center text-4xl" style="background-color: rgba(0,0,0,0.2);">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${item.image_url ? `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <img src="${item.image_url}" alt="${item.name}" class="w-full h-full object-cover rounded-lg" onerror="this.style.display='none'; this.parentElement.innerHTML='${getCategoryIcon(item.category)}';">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ` : getCategoryIcon(item.category)}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex-1">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h3 class="text-xl font-bold mb-1">${item.name}</h3>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-sm opacity-70 mb-2">Vendedor: ${item.seller_username}</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${item.discount > 0 ? `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-xs line-through opacity-50">$${item.price.toFixed(2)} USDT</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-lg font-bold" style="color: ${config.secondary_button};">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ğŸ’° $${item.final_price.toFixed(2)} USDTÂ 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="text-xs bg-red-600 text-white px-2 py-1 rounded-full">-${item.discount}%</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ` : `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-lg font-bold" style="color: ${config.secondary_button};">ğŸ’° $${item.price.toFixed(2)} USDT</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  `}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex flex-col justify-between items-end">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="removeFromCart(${index});" class="text-red-500 hover:text-red-700 font-bold">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  âŒ
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex items-center gap-2">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="updateCartQuantity(${index}, -1);" class="w-8 h-8 rounded-lg font-bold transition" style="background-color: ${config.primary_button}; color: white;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  -
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="w-12 text-center font-bold text-lg">${item.quantity}</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="updateCartQuantity(${index}, 1);" class="w-8 h-8 rounded-lg font-bold transition" style="background-color: ${config.primary_button}; color: white;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  +
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  `).join('')}
Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  <div class="lg:col-span-1">
Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="rounded-xl p-6 shadow-lg sticky top-4" style="background-color: ${config.card_background};">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h2 class="text-2xl font-bold mb-6">ğŸ“‹ Resumen del Pedido</h2>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="space-y-3 mb-6">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex justify-between">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span>Subtotal:</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="font-semibold">$${total.toFixed(2)} USDT</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex justify-between text-sm opacity-70">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span>Items:</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span>${cart.reduce((sum, item) => sum + item.quantity, 0)}</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="border-t pt-3 mt-3" style="border-color: rgba(255,255,255,0.1);">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex justify-between text-xl font-bold">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span>Total:</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span style="color: ${config.secondary_button};">ğŸ’° $${total.toFixed(2)} USDT</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="createOrder();" class="w-full py-4 rounded-lg font-bold text-lg transition mb-3" style="background-color: ${config.secondary_button}; color: white;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  âœ… Confirmar Pedido
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="clearCart();" class="w-full py-2 rounded-lg font-semibold transition bg-red-600 text-white">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ğŸ—‘ï¸ Vaciar Carrito
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="mt-6 p-4 rounded-lg" style="background-color: rgba(59, 130, 246, 0.1);">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-sm opacity-80">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ğŸ’¬ DespuÃ©s de confirmar, contacta al vendedor por Discord para coordinar la entrega
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  `}
Â  Â  Â  Â  Â  </main>
Â  Â  Â  Â  </div>
Â  Â  Â  `;
Â  Â  }

Â  Â  function renderOrders() {
Â  Â  Â  const config = getConfig();
Â  Â  Â  const myOrders = allOrders.filter(o => o.buyer_username === currentUser.username);

Â  Â  Â  return `
Â  Â  Â  Â  <div class="min-h-full" style="background-color: ${config.background_color}; color: ${config.text_color};">
Â  Â  Â  Â  Â  <header class="shadow-lg" style="background-color: ${config.card_background};">
Â  Â  Â  Â  Â  Â  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
Â  Â  Â  Â  Â  Â  Â  <div class="flex justify-between items-center">
Â  Â  Â  Â  Â  Â  Â  Â  <h1 class="text-3xl font-bold">ğŸ“¦ Mis Pedidos</h1>
Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="currentView='catalog'; render();" class="px-4 py-2 rounded-lg font-semibold transition" style="background-color: ${config.primary_button}; color: white;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  â† Volver al CatÃ¡logo
Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  </header>

Â  Â  Â  Â  Â  <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
Â  Â  Â  Â  Â  Â  ${myOrders.length === 0 ? `
Â  Â  Â  Â  Â  Â  Â  <div class="text-center py-20">
Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-4xl mb-4">ğŸ“¦</p>
Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-2xl opacity-60 mb-6">No tienes pedidos aÃºn</p>
Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="currentView='catalog'; render();" class="px-6 py-3 rounded-lg font-semibold transition" style="background-color: ${config.primary_button}; color: white;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Ver Productos
Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  ` : `
Â  Â  Â  Â  Â  Â  Â  <div class="space-y-4">
Â  Â  Â  Â  Â  Â  Â  Â  ${myOrders.map(order => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  const isPending = order.order_status === 'pending';
Â  Â  Â  Â  Â  Â  Â  Â  Â  const isCompleted = order.order_status === 'completed';
Â  Â  Â  Â  Â  Â  Â  Â  Â  return `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="rounded-xl p-6 shadow-lg" style="background-color: ${config.card_background};">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex flex-col lg:flex-row justify-between gap-4">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex-1">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex items-center gap-3 mb-3">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h3 class="text-xl font-bold">Pedido #${order.id.substring(0, 8)}</h3>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="px-3 py-1 rounded-full text-xs font-semibold ${isCompleted ? 'bg-green-600' : 'bg-yellow-600'} text-white">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${isCompleted ? 'âœ… Completado' : 'â³ Pendiente'}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="space-y-2 mb-4">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-sm"><span class="font-semibold">Vendedor:</span> ${order.seller_username}</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-sm"><span class="font-semibold">Discord:</span> ${order.seller_discord}</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-sm"><span class="font-semibold">Fecha:</span> ${new Date(order.created_at).toLocaleDateString()}</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="p-4 rounded-lg mb-4" style="background-color: rgba(0,0,0,0.2);">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="font-semibold mb-2">ğŸ“¦ Productos:</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-sm opacity-90">${order.items}</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-2xl font-bold" style="color: ${config.secondary_button};">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ğŸ’° Total: $${order.total.toFixed(2)} USDT
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </p>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${isPending ? `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="mt-4 p-3 rounded-lg" style="background-color: rgba(59, 130, 246, 0.1);">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-sm font-semibold mb-1">Estado de ConfirmaciÃ³n:</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-xs">Vendedor: ${order.seller_confirmed ? 'âœ… Confirmado' : 'â³ Pendiente'}</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-xs">Comprador (tÃº): ${order.buyer_confirmed ? 'âœ… Confirmado' : 'â³ Pendiente'}</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ` : ''}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex flex-col justify-between gap-3">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${isPending ? `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <buttonÂ 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  onclick="confirmOrder('${order.__backendId}', false);"Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${order.buyer_confirmed ? 'disabled' : ''}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  class="px-6 py-3 rounded-lg font-semibold transition disabled:opacity-50 disabled:cursor-not-allowed"Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  style="background-color: ${config.secondary_button}; color: white;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${order.buyer_confirmed ? 'âœ… Ya Confirmaste' : 'âœ… Confirmar Recibido'}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="p-3 rounded-lg text-center text-sm" style="background-color: rgba(59, 130, 246, 0.1);">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ğŸ’¬ Contacta al vendedor por Discord
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ` : `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="p-3 rounded-lg text-center" style="background-color: rgba(16, 185, 129, 0.2);">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="font-semibold text-green-400">âœ… Pedido Completado</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-xs mt-1 opacity-70">Gracias por tu compra</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  `}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â  Â  Â  }).join('')}
Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  `}
Â  Â  Â  Â  Â  </main>
Â  Â  Â  Â  </div>
Â  Â  Â  `;
Â  Â  }

Â  Â  function renderAdmin() {
Â  Â  Â  const config = getConfig();
Â  Â  Â  const userData = getCurrentUserData();
Â  Â  Â  if (!userData) return '<div>Error: Usuario no encontrado</div>';

Â  Â  Â  const userProducts = userData.role === 'admin'Â 
Â  Â  Â  Â  ? allProductsÂ 
Â  Â  Â  Â  : allProducts.filter(p => p.seller_username === userData.username);
Â  Â  Â  
Â  Â  Â  const pendingResellers = allUsers.filter(u => u.role === 'reseller' && !u.approved);
Â  Â  Â  
Â  Â  Â  const myOrders = userData.role === 'admin'
Â  Â  Â  Â  ? allOrders
Â  Â  Â  Â  : allOrders.filter(o => o.seller_username === userData.username);

Â  Â  Â  const myReviews = userData.role === 'admin'
Â  Â  Â  Â  ? []
Â  Â  Â  Â  : allReviews.filter(r => r.reviewed_seller === userData.username);

Â  Â  Â  const rating = userData.role === 'admin' ? null : getSellerRating(userData.username);
Â  Â  Â  
Â  Â  Â  const completedOrders = allOrders.filter(o => o.order_status === 'completed');
Â  Â  Â  
Â  Â  Â  const activeUsers = allUsers;
Â  Â  Â  
Â  Â  Â  const stats = {
Â  Â  Â  Â  total: userProducts.length,
Â  Â  Â  Â  items: userProducts.filter(p => p.category === 'items').length,
Â  Â  Â  Â  wings: userProducts.filter(p => p.category === 'wings').length,
Â  Â  Â  Â  sets: userProducts.filter(p => p.category === 'sets').length,
Â  Â  Â  Â  resellers: allUsers.filter(u => u.role === 'reseller' && u.approved).length,
Â  Â  Â  Â  pendingOrders: myOrders.filter(o => o.order_status === 'pending').length,
Â  Â  Â  Â  completedOrders: currentUser.role === 'admin' ? completedOrders.length : myOrders.filter(o => o.order_status === 'completed').length,
Â  Â  Â  Â  totalUsers: allUsers.length,
Â  Â  Â  Â  onlineUsers: onlineUsers.size,
Â  Â  Â  Â  buyers: allUsers.filter(u => u.role === 'buyer').length,
Â  Â  Â  Â  admins: allUsers.filter(u => u.role === 'admin').length,
Â  Â  Â  };

Â  Â  Â  return `
Â  Â  Â  Â  <div class="min-h-full" style="background-color: ${config.background_color}; color: ${config.text_color};">
Â  Â  Â  Â  Â  <header class="shadow-lg" style="background-color: ${config.card_background};">
Â  Â  Â  Â  Â  Â  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
Â  Â  Â  Â  Â  Â  Â  <div class="flex justify-between items-center">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex items-center gap-4">
Â  Â  Â  Â  Â  Â  Â  Â  Â  ${userData.profile_picture ? `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <img src="${userData.profile_picture}" alt="${userData.username}" class="w-20 h-20 rounded-full object-cover border-4 border-blue-500 shadow-lg" onerror="this.style.display='none';">
Â  Â  Â  Â  Â  Â  Â  Â  Â  ` : `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="w-20 h-20 rounded-full flex items-center justify-center text-4xl border-4 border-blue-500 shadow-lg" style="background-color: rgba(59, 130, 246, 0.2);">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ğŸ‘¤
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  `}
Â  Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h1 class="text-3xl font-bold">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${userData.role === 'admin' ? 'âš™ï¸ Panel de AdministraciÃ³n' : 'ğŸª Mi Tienda'}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </h1>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="opacity-70 mt-1">Bienvenido, ${userData.username}</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${rating && rating.count > 0 ? `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="mt-2 text-lg">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${renderStars(parseFloat(rating.average))}Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="font-semibold">${rating.average}</span>Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="text-sm opacity-70">(${rating.count} reseÃ±as)</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ` : ''}
Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex gap-2">
Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="currentView='catalog'; render();" class="px-4 py-2 rounded-lg font-semibold transition" style="background-color: ${config.primary_button}; color: white;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ğŸ  Inicio
Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="logout();" class="px-4 py-2 rounded-lg font-semibold transition bg-red-600 text-white">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ğŸšª Salir
Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  </header>

Â  Â  Â  Â  Â  <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
Â  Â  Â  Â  Â  Â  ${userData.role === 'admin' ? `
Â  Â  Â  Â  Â  Â  Â  <div class="rounded-xl p-6 shadow-lg mb-6" style="background-color: ${config.card_background};">
Â  Â  Â  Â  Â  Â  Â  Â  <h2 class="text-2xl font-bold mb-4 text-center">ğŸ’¾ GestiÃ³n de Datos</h2>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="exportData();" class="px-6 py-4 rounded-lg font-bold text-lg transition flex items-center justify-center gap-2" style="background-color: ${config.secondary_button}; color: white;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ğŸ“¥ Exportar Todos los Datos
Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="document.getElementById('importFileInput').click();" class="px-6 py-4 rounded-lg font-bold text-lg transition flex items-center justify-center gap-2" style="background-color: ${config.primary_button}; color: white;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ğŸ“¤ Importar Datos
Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="file" id="importFileInput" accept=".json" onchange="importData(event);" style="display: none;">
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="p-4 rounded-lg" style="background-color: rgba(59, 130, 246, 0.1);">
Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-sm opacity-90 mb-2">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <strong>ğŸ“¥ Exportar:</strong> Descarga un archivo JSON con toda la informaciÃ³n (usuarios, productos, pedidos).
Â  Â  Â  Â  Â  Â  Â  Â  Â  </p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-sm opacity-90">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <strong>ğŸ“¤ Importar:</strong> Carga un archivo JSON y actualiza en tiempo real.
Â  Â  Â  Â  Â  Â  Â  Â  Â  </p>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  <div class="rounded-xl p-6 shadow-lg mb-6" style="background-color: ${config.card_background};">
Â  Â  Â  Â  Â  Â  Â  Â  <h2 class="text-2xl font-bold mb-4 text-center">ğŸ‘¥ EstadÃ­sticas de Usuarios</h2>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="rounded-lg p-4 text-center" style="background-color: rgba(59, 130, 246, 0.2);">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-3xl font-bold text-blue-400">${stats.totalUsers}</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="mt-1 text-sm opacity-70">Usuarios Registrados</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="rounded-lg p-4 text-center" style="background-color: rgba(16, 185, 129, 0.2);">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-3xl font-bold text-green-400">${stats.onlineUsers}</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="mt-1 text-sm opacity-70">Usuarios En LÃ­nea</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="rounded-lg p-4 text-center" style="background-color: rgba(245, 158, 11, 0.2);">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-3xl font-bold text-orange-400">${stats.buyers}</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="mt-1 text-sm opacity-70">Compradores</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="rounded-lg p-4 text-center" style="background-color: rgba(168, 85, 247, 0.2);">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-3xl font-bold text-purple-400">${stats.admins}</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="mt-1 text-sm opacity-70">Administradores</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  ` : ''}

Â  Â  Â  Â  Â  Â  <div class="grid grid-cols-2 md:grid-cols-${userData.role === 'admin' ? '5' : '4'} gap-4 mb-8">
Â  Â  Â  Â  Â  Â  Â  <div class="rounded-xl p-6 text-center shadow-lg" style="background-color: ${config.card_background};">
Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-4xl font-bold" style="color: ${config.primary_button};">${stats.total}</p>
Â  Â  Â  Â  Â  Â  Â  Â  <p class="mt-2 opacity-70">Total Productos</p>
Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  ${currentUser.role === 'admin' ? `
Â  Â  Â  Â  Â  Â  Â  Â  <div class="rounded-xl p-6 text-center shadow-lg" style="background-color: ${config.card_background};">
Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-4xl font-bold" style="color: ${config.secondary_button};">${stats.resellers}</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="mt-2 opacity-70">Vendedores Activos</p>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  ` : ''}
Â  Â  Â  Â  Â  Â  Â  <div class="rounded-xl p-6 text-center shadow-lg" style="background-color: ${config.card_background};">
Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-4xl font-bold text-yellow-500">${stats.pendingOrders}</p>
Â  Â  Â  Â  Â  Â  Â  Â  <p class="mt-2 opacity-70">Pedidos Pendientes</p>
Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  <div class="rounded-xl p-6 text-center shadow-lg" style="background-color: ${config.card_background};">
Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-4xl font-bold text-green-500">${stats.completedOrders}</p>
Â  Â  Â  Â  Â  Â  Â  Â  <p class="mt-2 opacity-70">Pedidos Completados</p>
Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  <div class="rounded-xl p-6 text-center shadow-lg" style="background-color: ${config.card_background};">
Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-4xl font-bold" style="color: ${config.secondary_button};">âš”ï¸ ${stats.items}</p>
Â  Â  Â  Â  Â  Â  Â  Â  <p class="mt-2 opacity-70">Items</p>
Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  <div class="rounded-xl p-6 text-center shadow-lg" style="background-color: ${config.card_background};">
Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-4xl font-bold" style="color: ${config.secondary_button};">ğŸ¦… ${stats.wings}</p>
Â  Â  Â  Â  Â  Â  Â  Â  <p class="mt-2 opacity-70">Alas</p>
Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  ${myOrders.length > 0 ? `
Â  Â  Â  Â  Â  Â  Â  <div class="rounded-xl p-6 shadow-lg mb-8" style="background-color: ${config.card_background};">
Â  Â  Â  Â  Â  Â  Â  Â  <h2 class="text-2xl font-bold mb-4">ğŸ“¦ ${userData.role === 'admin' ? 'Todos los Pedidos' : 'Pedidos de Clientes'}</h2>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="space-y-4">
Â  Â  Â  Â  Â  Â  Â  Â  Â  ${myOrders.map(order => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const isPending = order.order_status === 'pending';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const isCompleted = order.order_status === 'completed';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="p-4 rounded-lg ${isPending ? 'border-2 border-yellow-500' : ''}" style="background-color: rgba(0,0,0,0.2);">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex flex-col lg:flex-row justify-between items-start gap-4 mb-3">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex-1">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex items-center gap-3 mb-2">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="font-bold text-lg">ğŸ“¦ Pedido #${order.id.substring(0, 8)}</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="px-3 py-1 rounded-full text-xs font-semibold ${isCompleted ? 'bg-green-600' : 'bg-yellow-600'} text-white">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${isCompleted ? 'âœ… Completado' : 'â³ Pendiente'}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-sm opacity-70">Cliente: ${order.buyer_username}</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-sm opacity-70">Discord: ${order.buyer_discord}</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-sm opacity-70">Fecha: ${new Date(order.created_at).toLocaleDateString()}</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${isPending && userData.role === 'reseller' ? `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <buttonÂ 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  onclick="confirmOrder('${order.__backendId}', true);"Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${order.seller_confirmed ? 'disabled' : ''}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  class="px-6 py-3 rounded-lg font-semibold transition disabled:opacity-50 disabled:cursor-not-allowed"Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  style="background-color: ${config.secondary_button}; color: white;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${order.seller_confirmed ? 'âœ… Ya Confirmaste' : 'âœ… Confirmar Entrega'}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ` : ''}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="p-3 rounded-lg mb-3" style="background-color: rgba(255,255,255,0.05);">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-sm font-semibold mb-1">Productos:</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-sm opacity-90">${order.items}</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-xl font-bold mb-2" style="color: ${config.secondary_button};">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ğŸ’° Total: $${order.total.toFixed(2)} USDT
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${isPending ? `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="p-3 rounded-lg" style="background-color: rgba(59, 130, 246, 0.1);">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-sm font-semibold mb-1">Estado de ConfirmaciÃ³n:</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-xs">Vendedor: ${order.seller_confirmed ? 'âœ… Confirmado' : 'â³ Pendiente'}</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-xs">Comprador: ${order.buyer_confirmed ? 'âœ… Confirmado' : 'â³ Pendiente'}</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${currentUser.role === 'reseller' && !order.seller_confirmed ? `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-xs mt-2 opacity-70">ğŸ’¬ Contacta al cliente: <span class="font-bold">${order.buyer_discord}</span></p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ` : ''}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ` : ''}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â  Â  Â  Â  }).join('')}
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  ` : ''}

Â  Â  Â  Â  Â  Â  ${userData.role === 'reseller' && myReviews.length > 0 ? `
Â  Â  Â  Â  Â  Â  Â  <div class="rounded-xl p-6 shadow-lg mb-8" style="background-color: ${config.card_background};">
Â  Â  Â  Â  Â  Â  Â  Â  <h2 class="text-2xl font-bold mb-4">â­ ReseÃ±as de Clientes</h2>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="space-y-3">
Â  Â  Â  Â  Â  Â  Â  Â  Â  ${myReviews.map(review => `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="p-4 rounded-lg" style="background-color: rgba(0,0,0,0.2);">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex justify-between items-start mb-2">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="font-semibold">ğŸ‘¤ ${review.buyer_username}</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-sm opacity-70">${new Date(review.created_at).toLocaleDateString()}</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="text-xl">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${renderStars(review.rating)}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${review.review_text ? `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-sm opacity-90 italic">"${review.review_text}"</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ` : ''}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  `).join('')}
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  ` : ''}

Â  Â  Â  Â  Â  Â  ${userData.role === 'admin' && pendingResellers.length > 0 ? `
Â  Â  Â  Â  Â  Â  Â  <div class="rounded-xl p-6 shadow-lg mb-8" style="background-color: ${config.card_background};">
Â  Â  Â  Â  Â  Â  Â  Â  <h2 class="text-2xl font-bold mb-4">â³ Solicitudes Pendientes (Borrado al rechazar)</h2>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="space-y-3">
Â  Â  Â  Â  Â  Â  Â  Â  Â  ${pendingResellers.map(user => `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 p-4 rounded-lg" style="background-color: rgba(0,0,0,0.2);">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="font-bold">ğŸ‘¤ ${user.username}</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-sm opacity-70">ğŸª ${user.shop_name}</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-sm opacity-70">ğŸ’¬ ${user.discord_tag}</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex gap-2">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="approveReseller('${user.__backendId}', true);" class="px-4 py-2 rounded-lg font-semibold transition text-white" style="background-color: ${config.secondary_button};">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  âœ… Aprobar
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="approveReseller('${user.__backendId}', false);" class="px-4 py-2 rounded-lg font-semibold transition bg-red-600 text-white">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  âŒ Rechazar (Borrar)
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  `).join('')}
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  ` : ''}

Â  Â  Â  Â  Â  Â  ${userData.role === 'admin' ? `
Â  Â  Â  Â  Â  Â  Â  <div class="rounded-xl p-6 shadow-lg mb-8" style="background-color: ${config.card_background};">
Â  Â  Â  Â  Â  Â  Â  Â  <h2 class="text-2xl font-bold mb-4">ğŸ‘¥ GestiÃ³n de Usuarios Activos</h2>
Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  <div class="mb-6">
Â  Â  Â  Â  Â  Â  Â  Â  Â  <inputÂ 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  type="text"Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  id="userSearchInput"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  placeholder="ğŸ” Buscar usuario..."
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  oninput="filterUsers(this.value)"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  class="w-full px-4 py-3 rounded-lg font-semibold"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  style="background-color: rgba(0,0,0,0.3); border: 2px solid rgba(255,255,255,0.2); color: ${config.text_color};">
Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  <div class="overflow-x-auto">
Â  Â  Â  Â  Â  Â  Â  Â  Â  <table class="w-full text-sm">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <thead>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <tr class="border-b" style="border-color: rgba(255,255,255,0.1);">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th class="text-left py-3 px-4">Usuario</th>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th class="text-left py-3 px-4">Discord</th>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th class="text-left py-3 px-4">Rol Actual</th>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th class="text-left py-3 px-4">Estado</th>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th class="text-left py-3 px-4">Tienda</th>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th class="text-left py-3 px-4">Productos</th>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th class="text-left py-3 px-4">En LÃ­nea</th>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th class="text-left py-3 px-4">Acciones</th>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </tr>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </thead>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <tbody id="usersTableBody">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${activeUsers.map(user => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const userProductCount = allProducts.filter(p => p.seller_username === user.username).length;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const isOnline = onlineUsers.has(user.username);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const isBanned = user.status === 'banned';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <tr class="user-row border-b hover:bg-opacity-50" data-username="${user.username.toLowerCase()}" style="border-color: rgba(255,255,255,0.05); ${isBanned ? 'background-color: rgba(239, 68, 68, 0.1);' : ''}">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td class="py-3 px-4">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <buttonÂ 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  onclick="viewUserProfile('${user.__backendId}');"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  class="font-semibold hover:underline"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  style="color: ${config.primary_button};">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ğŸ‘¤ ${user.username}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td class="py-3 px-4 text-xs opacity-70">ğŸ’¬ ${user.discord_tag || '-'}</td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td class="py-3 px-4">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="px-2 py-1 rounded-full text-xs font-semibold ${
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  user.role === 'admin' ? 'bg-purple-600' :Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  user.role === 'reseller' ? 'bg-blue-600' :Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'bg-green-600'
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } text-white">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${user.role === 'admin' ? 'ğŸ‘‘ Admin' : user.role === 'reseller' ? 'ğŸª Vendedor' : 'ğŸ›’ Comprador'}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td class="py-3 px-4">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="px-2 py-1 rounded-full text-xs font-semibold ${
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  isBanned ? 'bg-red-600' : user.approved ? 'bg-green-600' : 'bg-yellow-600'
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } text-white">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${isBanned ? 'ğŸš« BAN' : user.approved ? 'âœ…' : 'â³'}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td class="py-3 px-4 text-xs">${user.shop_name || '-'}</td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td class="py-3 px-4 text-center">${userProductCount}</td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td class="py-3 px-4 text-center">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="text-xl">${isOnline ? 'ğŸŸ¢' : 'âš«'}</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td class="py-3 px-4">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex gap-2 items-center">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <selectÂ 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  onchange="if(this.value) changeUserRole('${user.__backendId}', this.value);"Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  class="px-2 py-1 rounded text-xs font-semibold"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  style="background-color: rgba(0,0,0,0.3); border: 1px solid rgba(255,255,255,0.2); color: ${config.text_color};">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="">Rol...</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="buyer" ${user.role === 'buyer' ? 'disabled' : ''}>ğŸ›’ Comprador</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="reseller" ${user.role === 'reseller' ? 'disabled' : ''}>ğŸª Vendedor</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="admin" ${user.role === 'admin' ? 'disabled' : ''}>ğŸ‘‘ Admin</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </select>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="banUser('${user.__backendId}')" title="${isBanned ? 'Desbanear' : 'Banear'}" class="p-1 rounded hover:bg-white hover:bg-opacity-10">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${isBanned ? 'âœ…' : 'ğŸš«'}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="deleteUserAccount('${user.__backendId}')" title="Eliminar Cuenta" class="p-1 rounded hover:bg-red-600 text-red-500 hover:text-white transition">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ğŸ—‘ï¸
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </tr>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }).join('')}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </tbody>
Â  Â  Â  Â  Â  Â  Â  Â  Â  </table>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  ` : ''}

Â  Â  Â  Â  Â  Â  <div class="rounded-xl p-6 shadow-lg" style="background-color: ${config.card_background};">
Â  Â  Â  Â  Â  Â  Â  <h2 class="text-2xl font-bold mb-6">â• Agregar Producto</h2>
Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  <div class="mb-6 p-4 rounded-lg" style="background-color: rgba(255, 215, 0, 0.1); border: 2px solid rgba(255, 215, 0, 0.3);">
Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-center font-bold mb-2">ğŸ’° Recordatorio de ComisiÃ³n</p>
Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-sm text-center opacity-90">La plataforma cobra un <span class="font-bold text-xl" style="color: ${config.secondary_button};">10%</span> de todas tus ventas completadas</p>
Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  <form onsubmit="handleAddProduct(event);" class="grid md:grid-cols-2 gap-4">
Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  <label class="block text-sm font-semibold mb-2" for="productName">Nombre del Producto</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" id="productName" required class="w-full px-4 py-2 rounded-lg" style="background-color: rgba(0,0,0,0.3); border: 2px solid rgba(255,255,255,0.1); color: ${config.text_color};">
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  <label class="block text-sm font-semibold mb-2" for="productCategory">CategorÃ­a</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  <select id="productCategory" required class="w-full px-4 py-2 rounded-lg" style="background-color: rgba(0,0,0,0.3); border: 2px solid rgba(255,255,255,0.1); color: ${config.text_color};">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="items">âš”ï¸ Items</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="jewels">ğŸ’ Joyas</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="wings">ğŸ¦… Alas</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="sets">ğŸ›¡ï¸ Sets</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  </select>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  <label class="block text-sm font-semibold mb-2" for="productPrice">Precio (USDT)</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="number" id="productPrice" step="0.01" min="0" required class="w-full px-4 py-2 rounded-lg" style="background-color: rgba(0,0,0,0.3); border: 2px solid rgba(255,255,255,0.1); color: ${config.text_color};">
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  <label class="block text-sm font-semibold mb-2" for="productStock">Stock</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="number" id="productStock" min="0" required class="w-full px-4 py-2 rounded-lg" style="background-color: rgba(0,0,0,0.3); border: 2px solid rgba(255,255,255,0.1); color: ${config.text_color};">
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  <label class="block text-sm font-semibold mb-2" for="productDiscount">Descuento (%) - Opcional</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="number" id="productDiscount" min="0" max="100" value="0" class="w-full px-4 py-2 rounded-lg" style="background-color: rgba(0,0,0,0.3); border: 2px solid rgba(255,255,255,0.1); color: ${config.text_color};">
Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-xs opacity-60 mt-1">0 = Sin descuento</p>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  <div class="md:col-span-2">
Â  Â  Â  Â  Â  Â  Â  Â  Â  <label class="flex items-center gap-2 cursor-pointer">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="checkbox" id="productOnSale" class="w-5 h-5 rounded">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="font-semibold">ğŸ”¥ Marcar como PromociÃ³n (aparecerÃ¡ en categorÃ­a Promociones)</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  </label>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  <div class="md:col-span-2">
Â  Â  Â  Â  Â  Â  Â  Â  Â  <label class="block text-sm font-semibold mb-2" for="productDescription">DescripciÃ³n</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  <textarea id="productDescription" rows="3" required class="w-full px-4 py-2 rounded-lg" style="background-color: rgba(0,0,0,0.3); border: 2px solid rgba(255,255,255,0.1); color: ${config.text_color};"></textarea>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  <div class="md:col-span-2">
Â  Â  Â  Â  Â  Â  Â  Â  Â  <label class="block text-sm font-semibold mb-2" for="productImage">URL de Imagen (opcional)</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="url" id="productImage" placeholder="https://..." class="w-full px-4 py-2 rounded-lg" style="background-color: rgba(0,0,0,0.3); border: 2px solid rgba(255,255,255,0.1); color: ${config.text_color};">
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  <div class="md:col-span-2">
Â  Â  Â  Â  Â  Â  Â  Â  Â  <button type="submit" class="w-full py-3 rounded-lg font-bold text-lg transition" style="background-color: ${config.secondary_button}; color: white;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  â• Agregar Producto
Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  </form>

Â  Â  Â  Â  Â  Â  Â  <div class="mt-6 p-5 rounded-lg" style="background-color: rgba(59, 130, 246, 0.1); border: 2px solid rgba(59, 130, 246, 0.3);">
Â  Â  Â  Â  Â  Â  Â  Â  <h3 class="font-bold text-lg mb-3 flex items-center gap-2">
Â  Â  Â  Â  Â  Â  Â  Â  Â  ğŸ“¸ Â¿CÃ³mo subir imÃ¡genes para tus productos?
Â  Â  Â  Â  Â  Â  Â  Â  </h3>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="space-y-3 text-sm opacity-90">
Â  Â  Â  Â  Â  Â  Â  Â  Â  <p><strong>Paso 1:</strong> Ve a <a href="https://imgur.com/upload" target="_blank" rel="noopener noreferrer" class="font-bold underline hover:opacity-80" style="color: ${config.primary_button};">Imgur.com/upload</a></p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  <p><strong>Paso 2:</strong> Haz clic en "Browse" o arrastra tu imagen</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  <p><strong>Paso 3:</strong> Una vez subida, haz clic derecho en la imagen â†’ "Copiar direcciÃ³n de imagen"</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  <p><strong>Paso 4:</strong> Pega el link en el campo "URL de Imagen" arriba â¬†ï¸</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="mt-3 p-3 rounded" style="background-color: rgba(16, 185, 129, 0.1);">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-xs">ğŸ’¡ <strong>Tip:</strong> El link debe terminar en .jpg, .png o .gif. Si no, agrega ".jpg" al final del link de Imgur.</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  <div class="rounded-xl p-6 shadow-lg" style="background-color: ${config.card_background};">
Â  Â  Â  Â  Â  Â  Â  <h2 class="text-2xl font-bold mb-6">ğŸ“¦ Mis Productos</h2>
Â  Â  Â  Â  Â  Â  Â  ${userProducts.length === 0 ? `
Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-center py-8 opacity-60">No tienes productos aÃºn</p>
Â  Â  Â  Â  Â  Â  Â  ` : `
Â  Â  Â  Â  Â  Â  Â  Â  <div class="overflow-x-auto">
Â  Â  Â  Â  Â  Â  Â  Â  Â  <table class="w-full">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <thead>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <tr class="border-b" style="border-color: rgba(255,255,255,0.1);">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th class="text-left py-3 px-4">Producto</th>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${currentUser.role === 'admin' ? '<th class="text-left py-3 px-4">Vendedor</th>' : ''}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th class="text-left py-3 px-4">CategorÃ­a</th>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th class="text-left py-3 px-4">Precio</th>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th class="text-left py-3 px-4">Descuento</th>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th class="text-left py-3 px-4">Promo</th>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th class="text-left py-3 px-4">Stock</th>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th class="text-left py-3 px-4">AcciÃ³n</th>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </tr>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </thead>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <tbody>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${userProducts.map(product => `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <tr class="border-b hover:bg-opacity-50" style="border-color: rgba(255,255,255,0.05);">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td class="py-3 px-4 font-semibold">${product.name}</td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${currentUser.role === 'admin' ? `<td class="py-3 px-4 text-sm opacity-70">${product.seller_username}</td>` : ''}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td class="py-3 px-4">${getCategoryIcon(product.category)} ${getCategoryName(product.category)}</td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td class="py-3 px-4">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${product.discount > 0 ? `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-xs line-through opacity-50">$${product.price.toFixed(2)}</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="font-bold" style="color: ${config.secondary_button};">$${product.final_price.toFixed(2)} USDT</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ` : `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="font-bold" style="color: ${config.secondary_button};">$${product.price.toFixed(2)} USDT</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  `}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td class="py-3 px-4">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${product.discount > 0 ? `<span class="px-2 py-1 rounded-full text-xs font-bold bg-red-600 text-white">-${product.discount}%</span>` : '-'}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td class="py-3 px-4 text-center">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${product.on_sale ? 'ğŸ”¥' : '-'}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td class="py-3 px-4">${product.stock}</td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td class="py-3 px-4">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="deleteProduct('${product.__backendId}');" class="px-3 py-1 rounded-lg bg-red-600 text-white font-semibold hover:bg-red-700 transition">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ğŸ—‘ï¸
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </tr>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  `).join('')}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </tbody>
Â  Â  Â  Â  Â  Â  Â  Â  Â  </table>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  `}
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  </main>
Â  Â  Â  Â  Â  <div id="modalContainer"></div>
Â  Â  Â  Â  </div>
Â  Â  Â  `;
Â  Â  }

Â  Â  function renderModal() {
Â  Â  Â  const config = getConfig();

Â  Â  Â  if (showModal === 'login') {
Â  Â  Â  Â  return `
Â  Â  Â  Â  Â  <div class="fixed inset-0 modal-backdrop flex items-center justify-center z-50 p-4" onclick="if(event.target === this) { showModal = null; render(); }">
Â  Â  Â  Â  Â  Â  <div class="rounded-xl shadow-2xl w-full max-w-md p-8" style="background-color: ${config.card_background}; color: ${config.text_color};" onclick="event.stopPropagation();">
Â  Â  Â  Â  Â  Â  Â  <h2 class="text-3xl font-bold mb-6 text-center">ğŸ” Iniciar SesiÃ³n</h2>
Â  Â  Â  Â  Â  Â  Â  <form onsubmit="handleLogin(event);">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="mb-4">
Â  Â  Â  Â  Â  Â  Â  Â  Â  <label class="block text-sm font-semibold mb-2" for="loginUsername">Usuario</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" id="loginUsername" required class="w-full px-4 py-3 rounded-lg" style="background-color: rgba(0,0,0,0.3); border: 2px solid rgba(255,255,255,0.1); color: ${config.text_color};">
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="mb-6">
Â  Â  Â  Â  Â  Â  Â  Â  Â  <label class="block text-sm font-semibold mb-2" for="loginPassword">ContraseÃ±a</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="password" id="loginPassword" required class="w-full px-4 py-3 rounded-lg" style="background-color: rgba(0,0,0,0.3); border: 2px solid rgba(255,255,255,0.1); color: ${config.text_color};">
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <button type="submit" class="w-full py-3 rounded-lg font-bold text-lg transition mb-3" style="background-color: ${config.primary_button}; color: white;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Entrar
Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  <button type="button" onclick="showModal = null; render();" class="w-full py-2 rounded-lg font-semibold transition" style="background-color: rgba(255,255,255,0.1); color: ${config.text_color};">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Cancelar
Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  </form>
Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  `;
Â  Â  Â  }

Â  Â  Â  if (showModal === 'register') {
Â  Â  Â  Â  return `
Â  Â  Â  Â  Â  <div class="fixed inset-0 modal-backdrop flex items-center justify-center z-50 p-4" onclick="if(event.target === this) { showModal = null; render(); }">
Â  Â  Â  Â  Â  Â  <div class="rounded-xl shadow-2xl w-full max-w-md p-8" style="background-color: ${config.card_background}; color: ${config.text_color};" onclick="event.stopPropagation();">
Â  Â  Â  Â  Â  Â  Â  <h2 class="text-3xl font-bold mb-6 text-center">ğŸ“ Registro de Comprador</h2>
Â  Â  Â  Â  Â  Â  Â  <form onsubmit="handleRegisterBuyer(event);">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="mb-4">
Â  Â  Â  Â  Â  Â  Â  Â  Â  <label class="block text-sm font-semibold mb-2" for="buyerUsername">Usuario</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" id="buyerUsername" required class="w-full px-4 py-3 rounded-lg" style="background-color: rgba(0,0,0,0.3); border: 2px solid rgba(255,255,255,0.1); color: ${config.text_color};">
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="mb-4">
Â  Â  Â  Â  Â  Â  Â  Â  Â  <label class="block text-sm font-semibold mb-2" for="buyerPassword">ContraseÃ±a</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="password" id="buyerPassword" required class="w-full px-4 py-3 rounded-lg" style="background-color: rgba(0,0,0,0.3); border: 2px solid rgba(255,255,255,0.1); color: ${config.text_color};">
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="mb-6">
Â  Â  Â  Â  Â  Â  Â  Â  Â  <label class="block text-sm font-semibold mb-2" for="buyerDiscord">Discord Tag</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" id="buyerDiscord" placeholder="Usuario#1234" required class="w-full px-4 py-3 rounded-lg" style="background-color: rgba(0,0,0,0.3); border: 2px solid rgba(255,255,255,0.1); color: ${config.text_color};">
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <button type="submit" class="w-full py-3 rounded-lg font-bold text-lg transition mb-3" style="background-color: ${config.secondary_button}; color: white;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Registrarse
Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  <button type="button" onclick="showModal = null; render();" class="w-full py-2 rounded-lg font-semibold transition" style="background-color: rgba(255,255,255,0.1); color: ${config.text_color};">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Cancelar
Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  </form>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  `;
Â  Â  Â  }

Â  Â  Â  if (showModal === 'registerReseller') {
Â  Â  Â  Â  return `
Â  Â  Â  Â  Â  <div class="fixed inset-0 modal-backdrop flex items-center justify-center z-50 p-4" onclick="if(event.target === this) { showModal = null; render(); }">
Â  Â  Â  Â  Â  Â  <div class="rounded-xl shadow-2xl w-full max-w-md p-8" style="background-color: ${config.card_background}; color: ${config.text_color};" onclick="event.stopPropagation();">
Â  Â  Â  Â  Â  Â  Â  <h2 class="text-3xl font-bold mb-6 text-center">ğŸª Abrir Tienda</h2>
Â  Â  Â  Â  Â  Â  Â  <form onsubmit="handleRegisterReseller(event);">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="mb-4">
Â  Â  Â  Â  Â  Â  Â  Â  Â  <label class="block text-sm font-semibold mb-2" for="resellerUsername">Usuario</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" id="resellerUsername" required class="w-full px-4 py-3 rounded-lg" style="background-color: rgba(0,0,0,0.3); border: 2px solid rgba(255,255,255,0.1); color: ${config.text_color};">
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="mb-4">
Â  Â  Â  Â  Â  Â  Â  Â  Â  <label class="block text-sm font-semibold mb-2" for="resellerPassword">ContraseÃ±a</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="password" id="resellerPassword" required class="w-full px-4 py-3 rounded-lg" style="background-color: rgba(0,0,0,0.3); border: 2px solid rgba(255,255,255,0.1); color: ${config.text_color};">
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="mb-4">
Â  Â  Â  Â  Â  Â  Â  Â  Â  <label class="block text-sm font-semibold mb-2" for="resellerShop">Nombre de Tienda</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" id="resellerShop" placeholder="Mi Tienda Ã‰pica" required class="w-full px-4 py-3 rounded-lg" style="background-color: rgba(0,0,0,0.3); border: 2px solid rgba(255,255,255,0.1); color: ${config.text_color};">
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="mb-6">
Â  Â  Â  Â  Â  Â  Â  Â  Â  <label class="block text-sm font-semibold mb-2" for="resellerDiscord">Discord Tag</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" id="resellerDiscord" placeholder="Usuario#1234" required class="w-full px-4 py-3 rounded-lg" style="background-color: rgba(0,0,0,0.3); border: 2px solid rgba(255,255,255,0.1); color: ${config.text_color};">
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="mb-6 p-4 rounded-lg" style="background-color: rgba(59, 130, 246, 0.1);">
Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-sm opacity-80">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  âš ï¸ Tu solicitud serÃ¡ revisada por un administrador antes de ser aprobada.
Â  Â  Â  Â  Â  Â  Â  Â  Â  </p>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <button type="submit" class="w-full py-3 rounded-lg font-bold text-lg transition mb-3" style="background-color: ${config.primary_button}; color: white;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Enviar Solicitud
Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  <button type="button" onclick="showModal = null; render();" class="w-full py-2 rounded-lg font-semibold transition" style="background-color: rgba(255,255,255,0.1); color: ${config.text_color};">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Cancelar
Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  </form>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  `;
Â  Â  Â  }

Â  Â  Â  if (showModal === 'importConfirm' && selectedOrder) {
Â  Â  Â  Â  const importedData = selectedOrder;
Â  Â  Â  Â  return `
Â  Â  Â  Â  Â  <div class="fixed inset-0 modal-backdrop flex items-center justify-center z-50 p-4" onclick="if(event.target === this) { showModal = null; selectedOrder = null; render(); }">
Â  Â  Â  Â  Â  Â  <div class="rounded-xl shadow-2xl w-full max-w-md p-8" style="background-color: ${config.card_background}; color: ${config.text_color};" onclick="event.stopPropagation();">
Â  Â  Â  Â  Â  Â  Â  <h2 class="text-3xl font-bold mb-4 text-center">ğŸ“¤ Confirmar ImportaciÃ³n</h2>
Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  <div class="mb-6 p-4 rounded-lg" style="background-color: rgba(255, 215, 0, 0.1); border: 2px solid rgba(255, 215, 0, 0.3);">
Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-center font-bold mb-2">âš ï¸ Â¡Importante!</p>
Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-sm text-center opacity-90">Esto importarÃ¡ los datos del archivo JSON en tiempo real.</p>
Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  <div class="mb-6 p-4 rounded-lg" style="background-color: rgba(0,0,0,0.2);">
Â  Â  Â  Â  Â  Â  Â  Â  <p class="font-semibold mb-2">ğŸ“„ Resumen del archivo:</p>
Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-sm">ğŸ‘¥ Usuarios: ${importedData.users?.length || 0}</p>
Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-sm">ğŸ“¦ Productos: ${importedData.products?.length || 0}</p>
Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-sm">ğŸ›’ Pedidos: ${importedData.orders?.length || 0}</p>
Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-sm">â­ ReseÃ±as: ${importedData.reviews?.length || 0}</p>
Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-xs opacity-70 mt-2">ğŸ“… Exportado: ${new Date(importedData.exportDate || Date.now()).toLocaleString()}</p>
Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  <button id="confirmImportBtn" onclick="confirmImport();" class="w-full py-3 rounded-lg font-bold text-lg transition mb-3" style="background-color: ${config.secondary_button}; color: white;">
Â  Â  Â  Â  Â  Â  Â  Â  âœ… Confirmar ImportaciÃ³n
Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  <button type="button" onclick="showModal = null; selectedOrder = null; render();" class="w-full py-2 rounded-lg font-semibold transition" style="background-color: rgba(255,255,255,0.1); color: ${config.text_color};">
Â  Â  Â  Â  Â  Â  Â  Â  Cancelar
Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  `;
Â  Â  Â  }

Â  Â  Â  if (showModal === 'review' && selectedOrder && selectedOrder.order_status) {
Â  Â  Â  Â  return `
Â  Â  Â  Â  Â  <div class="fixed inset-0 modal-backdrop flex items-center justify-center z-50 p-4">
Â  Â  Â  Â  Â  Â  <div class="rounded-xl shadow-2xl w-full max-w-md p-8" style="background-color: ${config.card_background}; color: ${config.text_color};" onclick="event.stopPropagation();">
Â  Â  Â  Â  Â  Â  Â  <h2 class="text-3xl font-bold mb-4 text-center">â­ Calificar Pedido</h2>
Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  <div class="mb-6 p-4 rounded-lg" style="background-color: rgba(255, 215, 0, 0.1); border: 2px solid rgba(255, 215, 0, 0.3);">
Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-center font-bold mb-2">âš ï¸ Â¡CalificaciÃ³n Obligatoria!</p>
Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-sm text-center opacity-90">Debes calificar esta tienda para continuar usando el marketplace</p>
Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  <div class="mb-6 p-4 rounded-lg" style="background-color: rgba(0,0,0,0.2);">
Â  Â  Â  Â  Â  Â  Â  Â  <p class="font-semibold mb-1">ğŸª Tienda: ${selectedOrder.seller_username}</p>
Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-sm opacity-70">ğŸ’° Total: $${selectedOrder.total.toFixed(2)} USDT</p>
Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-sm opacity-70">ğŸ“¦ Pedido #${selectedOrder.id.substring(0, 8)}</p>
Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  <form onsubmit="handleSubmitReview(event);">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="mb-6">
Â  Â  Â  Â  Â  Â  Â  Â  Â  <label class="block text-sm font-semibold mb-3 text-center">CalificaciÃ³n *</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="star-rating">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${[5, 4, 3, 2, 1].map(star => `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="radio" id="star${star}" name="rating" value="${star}" class="hidden" required>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="star${star}" title="${star} estrellas"></label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  `).join('')}
Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  <div class="mb-6">
Â  Â  Â  Â  Â  Â  Â  Â  Â  <label class="block text-sm font-semibold mb-2" for="reviewText">Comentario (opcional)</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  <textarea id="reviewText" rows="4" placeholder="Comparte tu experiencia con esta tienda..." class="w-full px-4 py-3 rounded-lg" style="background-color: rgba(0,0,0,0.3); border: 2px solid rgba(255,255,255,0.1); color: ${config.text_color};"></textarea>
Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  <button type="submit" class="w-full py-3 rounded-lg font-bold text-lg transition" style="background-color: ${config.secondary_button}; color: white;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  â­ Enviar ReseÃ±a
Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  </form>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  `;
Â  Â  Â  }

Â  Â  Â  if (showModal === 'setupShop' && selectedOrder && !selectedOrder.order_status) {
Â  Â  Â  Â  const user = selectedOrder;
Â  Â  Â  Â  const isFromLogin = user.__backendId === currentUser?.__backendId;
Â  Â  Â  Â  return `
Â  Â  Â  Â  Â  <div class="fixed inset-0 modal-backdrop flex items-center justify-center z-50 p-4" onclick="if(event.target === this && isFromLogin) { showModal = null; render(); } else if (event.target === this) { logout(); showToast('Cierre de sesiÃ³n forzado por configuraciÃ³n incompleta.'); }">
Â  Â  Â  Â  Â  Â  <div class="rounded-xl shadow-2xl w-full max-w-md p-8" style="background-color: ${config.card_background}; color: ${config.text_color};" onclick="event.stopPropagation();">
Â  Â  Â  Â  Â  Â  Â  <h2 class="text-3xl font-bold mb-4 text-center">ğŸª Configurar Tienda</h2>
Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  <div class="mb-6 p-4 rounded-lg" style="background-color: ${isFromLogin ? 'rgba(255, 215, 0, 0.1); border: 2px solid rgba(255, 215, 0, 0.3)' : 'rgba(59, 130, 246, 0.1); border: 2px solid rgba(59, 130, 246, 0.3)'};">
Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-center font-bold mb-2">${isFromLogin ? 'âš ï¸ ConfiguraciÃ³n Obligatoria' : 'ğŸ“‹ InformaciÃ³n Requerida'}</p>
Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-sm text-center opacity-90">${isFromLogin ? 'Debes configurar tu tienda para poder acceder al marketplace' : `El usuario <span class="font-bold">${user.username}</span> necesita configurar su tienda para ser vendedor`}</p>
Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  <form onsubmit="handleSetupShop(event);">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="mb-4">
Â  Â  Â  Â  Â  Â  Â  Â  Â  <label class="block text-sm font-semibold mb-2" for="setupShopName">Nombre de la Tienda *</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  <inputÂ 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  type="text"Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  id="setupShopName"Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  placeholder="Mi Tienda Ã‰pica"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  requiredÂ 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  class="w-full px-4 py-3 rounded-lg"Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  style="background-color: rgba(0,0,0,0.3); border: 2px solid rgba(255,255,255,0.1); color: ${config.text_color};">
Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  <div class="mb-6">
Â  Â  Â  Â  Â  Â  Â  Â  Â  <label class="block text-sm font-semibold mb-2" for="setupDiscord">Discord Tag *</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  <inputÂ 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  type="text"Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  id="setupDiscord"Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  placeholder="Usuario#1234"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  value="${user.discord_tag || ''}"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  requiredÂ 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  class="w-full px-4 py-3 rounded-lg"Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  style="background-color: rgba(0,0,0,0.3); border: 2px solid rgba(255,255,255,0.1); color: ${config.text_color};">
Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  <div class="mb-6 p-4 rounded-lg" style="background-color: rgba(16, 185, 129, 0.1);">
Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-sm opacity-80">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  âœ… Una vez configurada la tienda, ${isFromLogin ? 'podrÃ¡s' : 'el usuario podrÃ¡'} agregar productos y vender
Â  Â  Â  Â  Â  Â  Â  Â  Â  </p>
Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  <button type="submit" class="w-full py-3 rounded-lg font-bold text-lg transition mb-3" style="background-color: ${config.secondary_button}; color: white;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  ğŸª Crear Tienda
Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  ${!isFromLogin ? `
